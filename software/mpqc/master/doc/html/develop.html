<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPQC: Using MPQC to Develop New Features</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MPQC
   &#160;<span id="projectnumber">4.0.0-beta.1</span>
   </div>
   <div id="projectbrief">Massively Parallel Electronic Structure platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('develop.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Using MPQC to Develop New Features </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are three modes in which MPQC can be used in developing software implementation of existing and new methods:</p><ul>
<li><b>native</b>: you develop within the MPQC source tree directly;</li>
<li><b>plug-in</b>: you plug your code into MPQC to extend its functionality, e.g. by adding new classes to MPQC;</li>
<li><b>plug-out</b>: you plug MPQC libraries into your project, e.g. by using MPQC classes and functions in your code.</li>
</ul>
<p>These methods are demonstrated and discussed below.</p><ul>
<li><a class="el" href="develop.html#develop-within-mpqc">Developing code within MPQC</a><ul>
<li><a class="el" href="develop.html#devcheck">Adding Test Cases to the Verification Suite</a></li>
</ul>
</li>
<li><a class="el" href="develop.html#extend-mpqc">Extending MPQC functionality</a><ul>
<li><a class="el" href="develop.html#devsampmp2">MP2 Implementation Example</a></li>
</ul>
</li>
<li><a class="el" href="develop.html#develop-outside-mpqc">Using MPQC as an external library in a separate project</a><ul>
<li><a class="el" href="develop.html#devsampaoints">AOInts Implementation Example</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="develop-within-mpqc"></a>
Developing code within MPQC</h1>
<p>This approach is useful when you want to extend and replace existing classes in MPQC, e.g. you want to add a new Wavefunction class that implements a new or existing electronic structure method.</p>
<p>The pros of this approach are:</p><ul>
<li>the user can take advantage of the MPQC infrastructure, e.g. the build system and test harness;</li>
<li>this approach makes it possible to eventually incorporate the new code into the MPQC master source repository for release and maintenance by the MPQC team.</li>
</ul>
<p>The recommended approach is to fork the MPQC source repo on Github (you can make a private fork, if you want) and develop the new code within that fork. An exception to this is if you are a member of the MPQC team: then you will want to develop your code on a branch within the main repo, as this allows you to take advantage of the Continuous Integration system even without making a pull request. Since, unlike forks, branches cannot be private; therefore use the fork mechanism is you must keep the code private.</p>
<p>You will want to periodically (i.e., often) sync with the changes in the main repo by merging in changes via the pull request mechanism or by direct git merge. When you are ready to marge your changes into the main repo create a pull request for code review and incorporation.</p>
<h2><a class="anchor" id="devcheck"></a>
Adding Test Cases to the Verification Suite</h2>
<p>Note to be added.</p>
<h1><a class="anchor" id="extend-mpqc"></a>
Extending MPQC functionality</h1>
<p>It is also possible to extend the functionality of the MPQC executable by adding new classes. The <em>plug-in</em> style approach allows you to keep your source separate from the rest of the MPQC.</p>
<p>To use this approach it is necessary to compile MPQC libraries and install them to the location specifies by the <code>CMAKE_INSTALL_PREFIX</code> CMake variable. It is recommended that the MPQC is validated before installation.</p>
<h2><a class="anchor" id="devsampmp2"></a>
MP2 Implementation Example</h2>
<p>To illustrate how to use the plug-in approach let's consider a simple example in which we extend the MPQC executable with a new implementation of MP2 energy. Although MPQC has several implementations of MP2 already, they all assume canonical orbitals, and whereas our new formulation will not make this assumption by solving the MP1 amplitude equations iteratively.</p>
<h3><a class="anchor" id="devsampmp2src"></a>
MP2 Implementation Example: Source</h3>
<p>This example code illustrates a complete MP2 energy implementation using the MPQC Toolkit. The source file can be found at <code>doc/devsamp/mp2/mp2.cpp</code> in the MPQC source directory. Note that the source file does not contain the <code><a class="el" href="mpqc_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a></code> function. Instead the MP2 class defined here will be linked into the MPQC executable and will become usable just like any other existing Wavefunction class in MPQC: you will be able to use it to compute gradients by finite differences, etc.</p>
<p>To compile the new class and link into the MPQC executable see the <a class="el" href="develop.html#devsampmp2mak">MP2 Implementation Example: CMakeLists.txt</a> section.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rhf_8h.html">mpqc/chemistry/qc/lcao/scf/rhf.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="lcao__wfn_8h.html">mpqc/chemistry/qc/lcao/wfn/lcao_wfn.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="energy_8h.html">mpqc/chemistry/qc/properties/energy.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="forcelink_8h.html">mpqc/util/keyval/forcelink.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacempqc.html">mpqc</a>;</div><div class="line"></div><div class="line"><span class="keyword">using</span> LCAOWfn = <a class="code" href="classmpqc_1_1lcao_1_1_l_c_a_o_wavefunction.html">lcao::LCAOWavefunction&lt;TA::TensorD, TA::SparsePolicy&gt;</a>;</div><div class="line"></div><div class="line"><span class="comment">// This is a basic implementation of (iterative) MP2 energy.</span></div><div class="line"><span class="comment">// This is formulated in terms of occupied and unoccupied states represented</span></div><div class="line"><span class="comment">// as LCAOs, hence it&#39;s derived from LCAOWfn, aka ::mpqc::lcao::LCAOWavefunction</span></div><div class="line"><span class="comment">// .</span></div><div class="line"><span class="comment">// This class can only compute the energy, this is indicated by deriving it from</span></div><div class="line"><span class="comment">// Provides&lt;Energy&gt; (this introduces virtual methods can_evaluate() and</span></div><div class="line"><span class="comment">// evaluate() that specify, respectively, the ability to compute the energy and</span></div><div class="line"><span class="comment">// how the energy is computed).</span></div><div class="line"><span class="keyword">class </span>MP2 : <span class="keyword">public</span> LCAOWfn, <span class="keyword">public</span> <a class="code" href="classmpqc_1_1_provides.html">Provides</a>&lt;Energy&gt; {</div><div class="line"> <span class="keyword">public</span>:</div><div class="line">  <span class="comment">// a few abbreviations to make the code less verbose</span></div><div class="line">  <span class="keyword">using</span> Array = TA::DistArray&lt;TA::TensorD, TA::SparsePolicy&gt;;</div><div class="line">  <span class="keyword">using</span> RHF = <a class="code" href="classmpqc_1_1lcao_1_1_r_h_f.html">lcao::RHF&lt;TA::TensorD, TA::SparsePolicy&gt;</a>;</div><div class="line"></div><div class="line">  <span class="comment">// the KeyVal constructor takes a KeyVal object that represents a keyword</span></div><div class="line">  <span class="comment">// group of the input file that corresponds to this object (see the &quot;mp2&quot;</span></div><div class="line">  <span class="comment">// group in the mp2.json file that accompanies this example).</span></div><div class="line">  <span class="comment">// The Keyval object will be queried for all keywords needed by</span></div><div class="line">  <span class="comment">// the KeyVal ctor of LCAOWfn, as well as keyword &quot;ref&quot; that specifies</span></div><div class="line">  <span class="comment">// the reference wave function.</span></div><div class="line">  MP2(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp; kv) : LCAOWfn(kv) {</div><div class="line">    ref_wfn_ = kv.<a class="code" href="classmpqc_1_1_key_val.html#af1e398eb00a68455ba539ecac59d0716">class_ptr</a>&lt;RHF&gt;(<span class="stringliteral">&quot;ref&quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> (!ref_wfn_)</div><div class="line">      <span class="keywordflow">throw</span> <a class="code" href="classmpqc_1_1_input_error.html">InputError</a>(<span class="stringliteral">&quot;missing reference RHF wave function&quot;</span>, __FILE__,</div><div class="line">                       __LINE__, <span class="stringliteral">&quot;ref&quot;</span>);</div><div class="line">  }</div><div class="line"></div><div class="line"> <span class="keyword">private</span>:</div><div class="line">  <span class="comment">// This implements the Energy::Provider::can_evaluate() virtual</span></div><div class="line">  <span class="comment">// function. This function returns true is the energy object can be computed.</span></div><div class="line">  <span class="keywordtype">bool</span> can_evaluate(<a class="code" href="classmpqc_1_1_energy.html">Energy</a>* energy)<span class="keyword"> override </span>{</div><div class="line">    <span class="comment">// can only compute energies (not forces (energy-&gt;order() == 1),</span></div><div class="line">    <span class="comment">// hessians, or higher derivatives)</span></div><div class="line">    <span class="keywordflow">return</span> energy-&gt;<a class="code" href="classmpqc_1_1math_1_1_taylor_expansion_function.html#a158e71d5c293c04144cd52ab2c96ae33">order</a>() == 0;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// This implements the Energy::Provider::evaluate() virtual function.</span></div><div class="line">  <span class="comment">// This function computes the MP2 energy and assigns it to the Energy object.</span></div><div class="line">  <span class="keywordtype">void</span> <a class="code" href="namespacempqc.html#ac0b13cc8fb142dbfa90e2953a1811ef6">evaluate</a>(<a class="code" href="classmpqc_1_1_energy.html">Energy</a>* energy)<span class="keyword"> override </span>{</div><div class="line">    <span class="comment">// how precisely to compute the energy</span></div><div class="line">    <span class="keyword">auto</span> target_precision = energy-&gt;<a class="code" href="classmpqc_1_1math_1_1_taylor_expansion_function.html#a81967e3dbce35635438139d388e00c07">target_precision</a>(0);</div><div class="line"></div><div class="line">    <span class="comment">// if has not been computed to the desired precision</span></div><div class="line">    <span class="comment">// (or never computed at all) ...</span></div><div class="line">    <span class="keywordflow">if</span> (computed_precision_ &gt; target_precision) {</div><div class="line">      <span class="comment">// compute reference to higher precision than this wfn</span></div><div class="line">      <span class="keyword">auto</span> target_ref_precision = target_precision / 100.;</div><div class="line">      <span class="keyword">auto</span> ref_energy =</div><div class="line">          std::make_shared&lt;Energy&gt;(ref_wfn_, target_ref_precision);</div><div class="line">      ref_wfn_-&gt;evaluate(ref_energy.get());</div><div class="line"></div><div class="line">      <span class="comment">// use the reference orbitals to populate the orbital space registry</span></div><div class="line">      init_sdref(ref_wfn_, target_ref_precision);</div><div class="line"></div><div class="line">      <span class="comment">// this actually computes the energy</span></div><div class="line">      <span class="keywordtype">double</span> mp2_corr_energy = compute_mp2_energy(target_precision);</div><div class="line"></div><div class="line">      energy_ = ref_energy-&gt;energy() + mp2_corr_energy;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// commit the result to energy</span></div><div class="line">    this-&gt;set_value(energy, energy_);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// This function actually solves the MP1 equations and returns the MP2 energy.</span></div><div class="line">  <span class="keywordtype">double</span> compute_mp2_energy(<span class="keywordtype">double</span> target_precision) {</div><div class="line">    <span class="comment">// fac is an LCAOFactory object which evaluates integrals in terms of AOs</span></div><div class="line">    <span class="comment">// and LCAOs</span></div><div class="line">    <span class="keyword">auto</span>&amp; fac = this-&gt;lcao_factory();</div><div class="line">    <span class="keyword">auto</span>&amp; world = fac.world();</div><div class="line">    <span class="comment">// ofac is an OrbitalSpaceRegistry that defines the LCAO spaces that fac can</span></div><div class="line">    <span class="comment">// use ofac was populated by the init_sdref() call above</span></div><div class="line">    <span class="keyword">auto</span>&amp; ofac = fac.orbital_registry();</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> nocc = ofac.retrieve(<span class="stringliteral">&quot;m&quot;</span>).rank();</div><div class="line">    <span class="keyword">auto</span> nocc_act = ofac.retrieve(<span class="stringliteral">&quot;i&quot;</span>).rank();</div><div class="line">    <span class="keyword">auto</span> nvir = ofac.retrieve(<span class="stringliteral">&quot;a&quot;</span>).rank();</div><div class="line">    <span class="keyword">auto</span> nfzc = nocc - nocc_act;</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> F = fac.compute(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;(p|F|q)&quot;</span>);</div><div class="line">    Eigen::VectorXd eps_p = <a class="code" href="namespacempqc_1_1math.html#ade7d64dce5df67a4a215df633267411f">math::array_to_eigen</a>(F).diagonal();</div><div class="line">    <span class="comment">// replicated diagonal elements of Fo</span></div><div class="line">    <span class="keyword">auto</span> eps_o = eps_p.segment(nfzc, nocc_act);</div><div class="line">    <span class="comment">// replicated diagonal elements of Fv</span></div><div class="line">    <span class="keyword">auto</span> eps_v = eps_p.tail(nvir);</div><div class="line"></div><div class="line">    <span class="comment">// G_iajb</span></div><div class="line">    <span class="keyword">auto</span> G = fac.compute(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;(i a|G|j b)&quot;</span>);</div><div class="line">    <span class="comment">// Fij</span></div><div class="line">    <span class="keyword">auto</span> Fo = fac.compute(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;(i|F|j)&quot;</span>);</div><div class="line">    <span class="comment">// Fab</span></div><div class="line">    <span class="keyword">auto</span> Fv = fac.compute(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;(a|F|b)&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// zero out amplitudes</span></div><div class="line">    <span class="keywordflow">if</span> (!T_.is_initialized()) {</div><div class="line">      T_ = Array(world, G.trange(), G.shape());</div><div class="line">      T_.fill(0.0);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// lambda function will be used to do a Jacobi update of the residual</span></div><div class="line">    <span class="keyword">auto</span> jacobi_update = [eps_o, eps_v](TA::TensorD&amp; result_tile) {</div><div class="line"></div><div class="line">      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; range = result_tile.range();</div><div class="line">      <span class="keywordtype">double</span> <a class="code" href="namespacempqc_1_1lcao_1_1f12_1_1detail.html#a535e5eb60efb5e9a44087e975f4be2a0">norm</a> = 0.0;</div><div class="line">      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; i : range) {</div><div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> result_abij = result_tile[i] / (eps_o[i[0]] - eps_v[i[1]] +</div><div class="line">                                                   eps_o[i[2]] - eps_v[i[3]]);</div><div class="line">        result_tile[i] = result_abij;</div><div class="line">        <a class="code" href="namespacempqc_1_1lcao_1_1f12_1_1detail.html#a535e5eb60efb5e9a44087e975f4be2a0">norm</a> += result_abij * result_abij;</div><div class="line">      }</div><div class="line">      <span class="keywordflow">return</span> std::sqrt(<a class="code" href="namespacempqc_1_1lcao_1_1f12_1_1detail.html#a535e5eb60efb5e9a44087e975f4be2a0">norm</a>);</div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">// solve the MP1 equations</span></div><div class="line">    <span class="keyword">auto</span> converged = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">auto</span> iter = 0;</div><div class="line">    <span class="keyword">auto</span> energy = +1.0;</div><div class="line">    <a class="code" href="classmpqc_1_1_ex_env.html#a9bff86d8c41e9444060de6c717df18c0">ExEnv::out0</a>() &lt;&lt; <span class="stringliteral">&quot;Start solving MP2 Energy\n&quot;</span>;</div><div class="line">    <span class="keywordflow">while</span> (not converged) {</div><div class="line">      Array R;</div><div class="line">      R(<span class="stringliteral">&quot;i,a,j,b&quot;</span>) = G(<span class="stringliteral">&quot;i,a,j,b&quot;</span>) + Fv(<span class="stringliteral">&quot;a,c&quot;</span>) * T_(<span class="stringliteral">&quot;i,c,j,b&quot;</span>) +</div><div class="line">                     Fv(<span class="stringliteral">&quot;b,c&quot;</span>) * T_(<span class="stringliteral">&quot;i,a,j,c&quot;</span>) - Fo(<span class="stringliteral">&quot;i,k&quot;</span>) * T_(<span class="stringliteral">&quot;k,a,j,b&quot;</span>) -</div><div class="line">                     Fo(<span class="stringliteral">&quot;j,k&quot;</span>) * T_(<span class="stringliteral">&quot;i,a,k,b&quot;</span>);</div><div class="line"></div><div class="line">      <span class="comment">// estimate the MP2 energy ... the Hylleraas formula is quadratic in error</span></div><div class="line">      <span class="keywordtype">double</span> updated_energy =</div><div class="line">          (G(<span class="stringliteral">&quot;i,a,j,b&quot;</span>) + R(<span class="stringliteral">&quot;i,a,j,b&quot;</span>)).dot(2 * T_(<span class="stringliteral">&quot;i,a,j,b&quot;</span>) - T_(<span class="stringliteral">&quot;i,b,j,a&quot;</span>));</div><div class="line">      <a class="code" href="classmpqc_1_1_ex_env.html#a9bff86d8c41e9444060de6c717df18c0">ExEnv::out0</a>() &lt;&lt; <a class="code" href="namespacempqc.html#a7ab6b5d37bb3db1f27ef8f78f690e8e6">indent</a> &lt;&lt; <span class="stringliteral">&quot;Iteration: &quot;</span> &lt;&lt; iter</div><div class="line">                    &lt;&lt; <span class="stringliteral">&quot; Energy: &quot;</span> &lt;&lt; updated_energy &lt;&lt; std::endl;</div><div class="line"></div><div class="line">      computed_precision_ = std::abs(updated_energy - energy);</div><div class="line">      energy = updated_energy;</div><div class="line"></div><div class="line">      <span class="comment">// update the amplitudes, if needed</span></div><div class="line">      converged = computed_precision_ &lt;= target_precision;</div><div class="line">      <span class="keywordflow">if</span> (not converged) {</div><div class="line">        <span class="comment">// R^{ij}_{ab} -&gt; R^{ij}_{ab} / (F^i_i + F^j_j - F^a_a - F^b_b)</span></div><div class="line">        TA::foreach_inplace(R, jacobi_update);</div><div class="line">        <span class="comment">// need a fence here since foreach_inplace mutates the contents of R</span></div><div class="line">        <span class="comment">// as a side effect.</span></div><div class="line">        <span class="comment">// N.B. most TiledArray ops will not need a fence (except to control</span></div><div class="line">        <span class="comment">//      the resource use)</span></div><div class="line">        world.gop.fence();</div><div class="line">        T_(<span class="stringliteral">&quot;i,a,j,b&quot;</span>) += R(<span class="stringliteral">&quot;i,a,j,b&quot;</span>);</div><div class="line">        ++iter;</div><div class="line">      }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> energy;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// This reimplements the ::mpqc::Wavefunction::obsolete() virtual function.</span></div><div class="line">  <span class="comment">// It gets called when, for example, the atomic positions get updated in</span></div><div class="line">  <span class="comment">// geometry optimization.</span></div><div class="line">  <span class="keywordtype">void</span> obsolete()<span class="keyword"> override </span>{</div><div class="line">    LCAOWfn::obsolete();</div><div class="line">    ref_wfn_-&gt;obsolete();</div><div class="line">    computed_precision_ = <a class="code" href="namespacempqc_1_1math.html#aa81e7a4a6cbfebe5b799ef5d68800682">std::numeric_limits&lt;double&gt;::max</a>();</div><div class="line">    energy_ = 0.0;</div><div class="line">  }</div><div class="line"></div><div class="line">  std::shared_ptr&lt;RHF&gt; ref_wfn_;</div><div class="line">  Array T_;</div><div class="line">  <span class="keywordtype">double</span> computed_precision_ = <a class="code" href="namespacempqc_1_1math.html#aa81e7a4a6cbfebe5b799ef5d68800682">std::numeric_limits&lt;double&gt;::max</a>();</div><div class="line">  <span class="keywordtype">double</span> energy_ = 0.0;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// This macro registers the KeyVal constructor of our MP2 class and associates</span></div><div class="line"><span class="comment">// it with the &quot;MP2&quot; key, so that the KeyVal class knows how to find it when it</span></div><div class="line"><span class="comment">// finds this key as the object type in the user input.</span></div><div class="line"><a class="code" href="forcelink_8h.html#a837d2c91108e8f94b86681d7d6eddd94">MPQC_CLASS_EXPORT2</a>(<span class="stringliteral">&quot;MP2&quot;</span>, MP2);</div><div class="line"></div><div class="line"><span class="comment">// Creating this variable forces the code for the MP2 class to be linked into</span></div><div class="line"><span class="comment">// the mp2 executable (otherwise the MPQC main function will not see any</span></div><div class="line"><span class="comment">// references to this class and thus the linker will simply skip it).</span></div><div class="line"><a class="code" href="classmpqc_1_1detail_1_1_force_link.html">mpqc::detail::ForceLink&lt;MP2&gt;</a> fl;</div></div><!-- fragment --><h3><a class="anchor" id="devsampmp2mak"></a>
MP2 Implementation Example: CMakeLists.txt</h3>
<p>Although it is possible to build our example manually, or use Make, it is recommended to use CMake. This is because KitWare's CMake tool is used to configure, build, and install MPQC itself. Installing MPQC will export key information about the MPQC libraries and other prerequisites (e.g., <a class="el" href="namespace_tiled_array.html">TiledArray</a> and MADWorld runtime) that is necessary to compile the code against them (e.g., the interlibrary dependencies, the compiler and linker flags, etc.). This exported info then makes it incredibly easy to use CMake to build our example in a few lines of CMake code. This file, located at <code>doc/devsamp/mp2/CMakeLists.txt</code> in the MPQC build directory, was generated from the <code>doc/devsamp/mp2/CMakeLists.txt.in</code> template located in the MPQC source directory.</p>
<p>The CMakeLists.txt file illustrates how to compile the <code><a class="el" href="mp2_8cpp.html">mp2.cpp</a></code> source and use it to create the <code>mp2</code> executable by linking against MPQC libraries. Note that the MPQC library names do not appear explicitly: instead we use their CMake target <code>MPQCmain</code> .</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.0)</div><div class="line"></div><div class="line"><span class="preprocessor"># change to the location of the mpqc installation (the value of CMAKE_INSTALL_PREFIX variable)</span></div><div class="line"><span class="preprocessor"># e.g. if the mpqc executable is at /usr/local/bin/mpqc, set this to /usr/local</span></div><div class="line"><span class="keyword">set</span>(mpqc_root_dir <span class="stringliteral">&quot;/Users/evaleev/code/install/mpqc-clang&quot;</span>)</div><div class="line"></div><div class="line"># Import MPQC package</div><div class="line"># 1. MPQCmain <a class="code" href="namespacempqc.html#a5215b3d033b3a0a2ab3ac5a3c267d73f">provides</a> MPQC<span class="stringliteral">&#39;s main and the full MPQC functionality as its prereq (omit if roll your own)</span></div><div class="line"><span class="stringliteral">find_package(mpqc 0.10.1 CONFIG QUIET REQUIRED COMPONENTS MPQCmain HINTS ${mpqc_root_dir})</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral"># add the executable</span></div><div class="line"><span class="stringliteral">set(program mp2)</span></div><div class="line"><span class="stringliteral">add_executable(${program} EXCLUDE_FROM_ALL ${program}.cpp)</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral"># mp2 uses MPQC main and thus links in all classes that the MPQC main links in</span></div><div class="line"><span class="stringliteral"># to customize the included functionality you will need to provide your own main</span></div><div class="line"><span class="stringliteral">target_link_libraries(${program} MPQCmain ${MADNESS_DISABLEPIE_LINKER_FLAG})</span></div><div class="line"><span class="stringliteral"></span></div></div><!-- fragment --><h3><a class="anchor" id="devsampmp2inp"></a>
MP2 Implementation Example: Input</h3>
<p>This input JSON file can be used with the program illustrated in the <a class="el" href="develop.html#devsampmp2src">MP2 Implementation Example: Source</a> section.</p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;property&quot;</span> : {</div><div class="line">    <span class="stringliteral">&quot;type&quot;</span> : <span class="stringliteral">&quot;Energy&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;wfn&quot;</span> : <span class="stringliteral">&quot;$:mp2&quot;</span></div><div class="line">  },</div><div class="line">  <span class="stringliteral">&quot;mp2&quot;</span>:{</div><div class="line">    <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;MP2&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;frozen_core&quot;</span> : <span class="keyword">true</span>,</div><div class="line">    <span class="stringliteral">&quot;atoms&quot;</span> : <span class="stringliteral">&quot;$:water&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;wfn_world&quot;</span> : <span class="stringliteral">&quot;$:wfn_world&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;ref&quot;</span> : <span class="stringliteral">&quot;$:rhf&quot;</span></div><div class="line">  },</div><div class="line">  <span class="stringliteral">&quot;wfn_world&quot;</span>:{</div><div class="line">    <span class="stringliteral">&quot;atoms&quot;</span> : <span class="stringliteral">&quot;$:water&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;basis&quot;</span> : <span class="stringliteral">&quot;$:basis&quot;</span></div><div class="line">  },</div><div class="line">  <span class="stringliteral">&quot;rhf&quot;</span>:{</div><div class="line">    <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;RHF&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;atoms&quot;</span> : <span class="stringliteral">&quot;$:water&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;wfn_world&quot;</span> : <span class="stringliteral">&quot;$:wfn_world&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;localize&quot;</span> : <span class="keyword">true</span>,</div><div class="line">    <span class="stringliteral">&quot;localize_core&quot;</span> : <span class="keyword">false</span></div><div class="line">  },</div><div class="line">  <span class="stringliteral">&quot;water&quot;</span>: {</div><div class="line">    <span class="stringliteral">&quot;atoms&quot;</span>: [</div><div class="line">      { <span class="stringliteral">&quot;element&quot;</span>: <span class="stringliteral">&quot;O&quot;</span>, <span class="stringliteral">&quot;xyz&quot;</span>:[ 0.00000, -0.07579,  0.00000] },</div><div class="line">      { <span class="stringliteral">&quot;element&quot;</span>: <span class="stringliteral">&quot;H&quot;</span>, <span class="stringliteral">&quot;xyz&quot;</span>:[ 0.86681,  0.60144,  0.00000] },</div><div class="line">      { <span class="stringliteral">&quot;element&quot;</span>: <span class="stringliteral">&quot;H&quot;</span>, <span class="stringliteral">&quot;xyz&quot;</span>:[-0.86681,  0.60144,  0.00000] }</div><div class="line">    ]</div><div class="line">  },</div><div class="line">  <span class="stringliteral">&quot;basis&quot;</span>: {</div><div class="line">    <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;6-31G&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;atoms&quot;</span>: <span class="stringliteral">&quot;$:water&quot;</span></div><div class="line">  }</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><h1><a class="anchor" id="develop-outside-mpqc"></a>
Using MPQC as an external library in a separate project</h1>
<p>To use MPQC from a standalone project it is necessary to compile MPQC libraries and install them to the location specifies by the <code>CMAKE_INSTALL_PREFIX</code> CMake variable. It is recommended that the MPQC is validated before installation.</p>
<p>To use the MPQC code your program must do the following before using any nontrivial MPQC functionality:</p><ul>
<li>initialize the MADWorld parallel runtime, by calling <code>madness::initialize</code>() ; this will initialize the MPI runtime by calling MPI_Init_thread ;</li>
<li>initialize the MPQC package and the dependent components (e.g., the Libint2 Gaussian integral library) by calling <a class="el" href="group___init.html#ga7f806bc719651bfb7633ac1d94760626" title="Static MPQC initializer. Must be called from the main thread of every process in the default MADWorld...">mpqc::initialize()</a>;</li>
</ul>
<p>After the MPQC functionality is no longer needed, you can release resources by calling <a class="el" href="group___init.html#gae6fc4ad046972e6dc2a61fa64b069e9a" title="Finalize MPQC. ">mpqc::finalize()</a> . This is not necessary if you are about to exit the program: the MPQC resources are released automatically when the program exits. Note that it is possible to call <a class="el" href="group___init.html#ga7f806bc719651bfb7633ac1d94760626" title="Static MPQC initializer. Must be called from the main thread of every process in the default MADWorld...">mpqc::initialize()</a> again after calling <a class="el" href="group___init.html#gae6fc4ad046972e6dc2a61fa64b069e9a" title="Finalize MPQC. ">mpqc::finalize()</a>.</p>
<p>After the MADWorld runtime is no longer needed, it is recommended to call <code>madness::finalize</code>() . You should not call <code>madness::initialize</code>() again after calling <code>madness::finalize</code>() because the MPI Standard does not specify whether the MPI libraries must support more than one initialize/finalize cycle.</p>
<h2><a class="anchor" id="devsampaoints"></a>
AOInts Implementation Example</h2>
<p>To illustrate how to use the plug-out approach let's consider a simple example in which we use MPQC functionality to compute 2-body Coulomb integrals with brakets constisting of 2, 3, and 4 atomic orbitals (in the quantum chemistry context these are referred to as 2-, 3-, and 4-center electron repulsion integrals). The 2- and 3-index integrals are used to approximate the 4-center integrals by density fitting, which involves some simple tensor algebra.</p>
<h3><a class="anchor" id="devsampaointssrc"></a>
AOInts Implementation Example: Source</h3>
<p>This example code illustrates how to construct <a class="el" href="namespace_tiled_array.html">TiledArray</a> tensors of AO integrals using the MPQC Toolkit. The source file can be found at <code>doc/devsamp/aoints/aoints.cpp</code> in the MPQC source directory. Note that the source file does contain the <code><a class="el" href="mpqc_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a></code> function which explicitly includes all steps needed to initialize MPQC.</p>
<p>To compile the new class and link into the MPQC executable see the <a class="el" href="develop.html#devsampaointsmak">AOInts Implementation Example: CMakeLists.txt</a> section.</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Created by Eduard Valeyev on 8/13/18.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;clocale&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;madness/world/worldgop.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="tiledarray_8h.html">tiledarray.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mpqc__init_8h.html">mpqc/mpqc_init.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="keyval_8h.html">mpqc/util/keyval/keyval.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="exenv_8h.html">mpqc/util/core/exenv.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ao__factory_8h.html">mpqc/chemistry/qc/lcao/factory/ao_factory.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="qc_2lcao_2factory_2linkage_8h.html">mpqc/chemistry/qc/lcao/factory/linkage.h</a>&quot;</span></div><div class="line"></div><div class="line">madness::World* <a class="code" href="mpqc__test_8cpp.html#a6851364ac7fcf57a663c92790ce09dcd">world_ptr</a> = <span class="keyword">nullptr</span>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="mpqc_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[] )</div><div class="line">{</div><div class="line">  <a class="code" href="mpqc__test_8cpp.html#a6851364ac7fcf57a663c92790ce09dcd">world_ptr</a> = &amp;<a class="code" href="group___init.html#ga7f806bc719651bfb7633ac1d94760626">madness::initialize</a>(argc, argv);</div><div class="line">  assert(<a class="code" href="mpqc__test_8cpp.html#a6851364ac7fcf57a663c92790ce09dcd">world_ptr</a> != <span class="keyword">nullptr</span>);</div><div class="line">  <a class="code" href="group___init.html#ga7f806bc719651bfb7633ac1d94760626">mpqc::initialize</a>(argc, argv, *<a class="code" href="mpqc__test_8cpp.html#a6851364ac7fcf57a663c92790ce09dcd">world_ptr</a>);</div><div class="line"></div><div class="line">  std::shared_ptr&lt;mpqc::KeyVal&gt; kv =</div><div class="line">      <a class="code" href="classmpqc_1_1_m_p_q_c_init.html#aca9e53b2bc42116bae01ba6426eeb4a5">mpqc::MPQCInit::instance</a>().<a class="code" href="classmpqc_1_1_m_p_q_c_init.html#a692c43b48a607149b184691cc69ab12a">make_keyval</a>(*<a class="code" href="mpqc__test_8cpp.html#a6851364ac7fcf57a663c92790ce09dcd">world_ptr</a>, <span class="stringliteral">&quot;aoints.json&quot;</span>);</div><div class="line">  kv-&gt;assign(<span class="stringliteral">&quot;world&quot;</span>, <a class="code" href="mpqc__test_8cpp.html#a6851364ac7fcf57a663c92790ce09dcd">world_ptr</a>);   <span class="comment">// set &quot;$:world&quot; keyword to &amp;world to define the default execution context for this input</span></div><div class="line">  TA::set_default_world(*<a class="code" href="mpqc__test_8cpp.html#a6851364ac7fcf57a663c92790ce09dcd">world_ptr</a>);  <span class="comment">// must specify default world to avoid madness::World::get_default() getting called</span></div><div class="line"></div><div class="line">  <span class="comment">// madness::World::get_default() getting called</span></div><div class="line">  <span class="keyword">using</span> <a class="code" href="classmpqc_1_1lcao_1_1gaussian_1_1_a_o_factory.html">mpqc::lcao::gaussian::AOFactory</a>;</div><div class="line">  <span class="keyword">auto</span> aofactory = std::make_shared&lt;AOFactory&lt;TA::TensorD,TA::SparsePolicy&gt;&gt;(*kv);</div><div class="line"></div><div class="line">  <span class="keyword">auto</span> eri4 = aofactory-&gt;<a class="code" href="classmpqc_1_1lcao_1_1gaussian_1_1_a_o_factory.html#a8ab292ab2eff02e1be7db163e926c91f">compute</a>(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;(μ ν| G |κ λ)&quot;</span>);</div><div class="line">  <span class="keyword">auto</span> eri3 = aofactory-&gt;compute(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;( Κ | G |κ λ)&quot;</span>);</div><div class="line">  <span class="keyword">auto</span> eri2 = aofactory-&gt;compute(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;( Κ | G | Λ )&quot;</span>);</div><div class="line">  <span class="keyword">auto</span> eri2_sqrt_inv = aofactory-&gt;compute(<a class="code" href="namespacempqc_1_1math_1_1groups.html#ab3f569c5ba1baa8c8798f84b4bea5a73">L</a><span class="stringliteral">&quot;( Κ | G | Λ )[inv_sqr]&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// test eri2_sqrt_inv</span></div><div class="line">  {</div><div class="line">    <span class="keyword">auto</span> identity = <a class="code" href="namespacempqc_1_1math.html#ace657782a8aaa004b37bdad946ecdc44">mpqc::math::create_diagonal_matrix</a>(eri2, 1.0);</div><div class="line">    TA::TSpArrayD <a class="code" href="namespacempqc_1_1cc.html#a15805b951e6c938bcf1f6bad1c52a58e">zero</a>;</div><div class="line">    <a class="code" href="namespacempqc_1_1cc.html#a15805b951e6c938bcf1f6bad1c52a58e">zero</a>(<span class="stringliteral">&quot;m,l&quot;</span>) = identity(<span class="stringliteral">&quot;m,l&quot;</span>) - eri2(<span class="stringliteral">&quot;m,n&quot;</span>) * eri2_sqrt_inv(<span class="stringliteral">&quot;n,k&quot;</span>) * eri2_sqrt_inv(<span class="stringliteral">&quot;k,l&quot;</span>);</div><div class="line">    <a class="code" href="classmpqc_1_1_ex_env.html#a9bff86d8c41e9444060de6c717df18c0">mpqc::ExEnv::out0</a>() &lt;&lt; <span class="stringliteral">&quot;testing V^{-1/2}: this should be zero = &quot;</span> &lt;&lt; <a class="code" href="namespacempqc_1_1cc.html#a179c71930ff8c84e6d6d23d8bae183e9">TA::norm2</a>(<a class="code" href="namespacempqc_1_1cc.html#a15805b951e6c938bcf1f6bad1c52a58e">zero</a>) &lt;&lt; std::endl;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// test DF reconstruction of eri4</span></div><div class="line">  {</div><div class="line">    TA::TSpArrayD B;</div><div class="line">    B(<span class="stringliteral">&quot;K,p,q&quot;</span>) = eri2_sqrt_inv(<span class="stringliteral">&quot;K,X&quot;</span>) * eri3(<span class="stringliteral">&quot;X,p,q&quot;</span>);</div><div class="line">    TA::TSpArrayD dferror4;</div><div class="line">    dferror4(<span class="stringliteral">&quot;p,q,r,s&quot;</span>) = eri4(<span class="stringliteral">&quot;p,q,r,s&quot;</span>) - B(<span class="stringliteral">&quot;K,p,q&quot;</span>) * B(<span class="stringliteral">&quot;K,r,s&quot;</span>);</div><div class="line">    <a class="code" href="classmpqc_1_1_ex_env.html#a9bff86d8c41e9444060de6c717df18c0">mpqc::ExEnv::out0</a>() &lt;&lt; <span class="stringliteral">&quot;testing DF: this should be small (and decrease with increasing DF basis) = &quot;</span> &lt;&lt; <a class="code" href="namespacempqc_1_1cc.html#a179c71930ff8c84e6d6d23d8bae183e9">TA::norm2</a>(dferror4) &lt;&lt; std::endl;</div><div class="line">  }</div><div class="line">  </div><div class="line">  <a class="code" href="group___init.html#gae6fc4ad046972e6dc2a61fa64b069e9a">mpqc::finalize</a>();</div><div class="line">  <a class="code" href="group___init.html#gae6fc4ad046972e6dc2a61fa64b069e9a">madness::finalize</a>();</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="devsampaointsmak"></a>
AOInts Implementation Example: CMakeLists.txt</h3>
<p>Just like with the MP2 example, it is recommended to use CMake to build this example. See file <code>doc/devsamp/mp2/CMakeLists.txt</code> located in the MPQC build directory that was generated from the <code>doc/devsamp/mp2/CMakeLists.txt.in</code> template located in the MPQC source directory.</p>
<p>The CMakeLists.txt file illustrates how to compile the <code>aoints.cpp</code> source and use it to create the <code>aoints</code> executable by linking against MPQC libraries. Note that the MPQC library names do not appear explicitly: instead we use their CMake target <code>libmpqc</code> (unlike the CMake target <code>MPQCmain</code> that we used previously, <code>libmpqc</code> does not include MPQC's <code><a class="el" href="mpqc_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a></code> function ).</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.0)</div><div class="line"></div><div class="line"><span class="preprocessor"># change to the location of the mpqc installation (the value of CMAKE_INSTALL_PREFIX variable)</span></div><div class="line"><span class="preprocessor"># e.g. if the mpqc executable is at /usr/local/bin/mpqc, set this to /usr/local</span></div><div class="line"><span class="keyword">set</span>(mpqc_root_dir <span class="stringliteral">&quot;/Users/evaleev/code/install/mpqc-clang&quot;</span>)</div><div class="line"></div><div class="line"># Import MPQC package</div><div class="line"># 1. MPQCmain <a class="code" href="namespacempqc.html#a5215b3d033b3a0a2ab3ac5a3c267d73f">provides</a> MPQC<span class="stringliteral">&#39;s main and the full MPQC functionality as its prereq (omit if roll your own)</span></div><div class="line"><span class="stringliteral">find_package(mpqc 0.10.1 CONFIG QUIET REQUIRED COMPONENTS libmpqc HINTS ${mpqc_root_dir})</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral"># add the executable</span></div><div class="line"><span class="stringliteral">set(program aoints)</span></div><div class="line"><span class="stringliteral">add_executable(${program} EXCLUDE_FROM_ALL ${program}.cpp)</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral"># mp2 uses MPQC main and thus links in all classes that the MPQC main links in</span></div><div class="line"><span class="stringliteral"># to customize the included functionality you will need to provide your own main</span></div><div class="line"><span class="stringliteral">target_link_libraries(${program} libmpqc ${MADNESS_DISABLEPIE_LINKER_FLAG})</span></div></div><!-- fragment --><h3><a class="anchor" id="devsampaointsinp"></a>
AOInts Implementation Example: Input</h3>
<p>This input JSON file can be used with the program illustrated in the <a class="el" href="develop.html#devsampaointssrc">AOInts Implementation Example: Source</a> section.</p>
<div class="fragment"><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;wfn_world&quot;</span>: {</div><div class="line">    <span class="stringliteral">&quot;atoms&quot;</span> : <span class="stringliteral">&quot;$:water&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;basis&quot;</span>: {</div><div class="line">      <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;6-31G&quot;</span>,</div><div class="line">      <span class="stringliteral">&quot;atoms&quot;</span>: <span class="stringliteral">&quot;$:water&quot;</span></div><div class="line">    },</div><div class="line">    <span class="stringliteral">&quot;df_basis&quot;</span>: {</div><div class="line">      <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;aug-cc-pVDZ&quot;</span>,</div><div class="line">      <span class="stringliteral">&quot;atoms&quot;</span>: <span class="stringliteral">&quot;$:water&quot;</span></div><div class="line">    }</div><div class="line">  },</div><div class="line">  <span class="stringliteral">&quot;water&quot;</span>: {</div><div class="line">    <span class="stringliteral">&quot;atoms&quot;</span>: [</div><div class="line">      { <span class="stringliteral">&quot;element&quot;</span>: <span class="stringliteral">&quot;O&quot;</span>, <span class="stringliteral">&quot;xyz&quot;</span>:[ 0.00000, -0.07579,  0.00000] },</div><div class="line">      { <span class="stringliteral">&quot;element&quot;</span>: <span class="stringliteral">&quot;H&quot;</span>, <span class="stringliteral">&quot;xyz&quot;</span>:[ 0.86681,  0.60144,  0.00000] },</div><div class="line">      { <span class="stringliteral">&quot;element&quot;</span>: <span class="stringliteral">&quot;H&quot;</span>, <span class="stringliteral">&quot;xyz&quot;</span>:[-0.86681,  0.60144,  0.00000] }</div><div class="line">    ]</div><div class="line">  }</div><div class="line">}</div><div class="line"></div></div><!-- fragment --><p>The contents of this file are used to construct a KeyVal object used to construct MPQC infrastructure classes; since it is possible to construct KeyVal objects programmatically, it is not necessary to use input files, but here we use it for simplicity. It is, for example, possible to change the basis sets in this file without needing to recompile the <code>aoints</code> program. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<address>
<small>
Generated at Mon Aug 27 2018 08:29:38 for <a
href="http://www.mpqc.org">MPQC</a>
4.0.0-beta.1 using the documentation package <a
href="http://www.doxygen.org">Doxygen</a>
1.8.14.
</small>
</address>
</body>
</html>
