<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPQC: mpqc/util/keyval/keyval.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MPQC
   &#160;<span id="projectnumber">4.0.0-beta.1</span>
   </div>
   <div id="projectbrief">Massively Parallel Electronic Structure platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('keyval_8h_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">keyval.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="keyval_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * keyval.h</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Apr 18, 2016</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: evaleev</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#ifndef MPQC4_SRC_MPQC_UTIL_KEYVAL_KEYVAL_H_</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#define MPQC4_SRC_MPQC_UTIL_KEYVAL_KEYVAL_H_</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;boost/property_tree/info_parser.hpp&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;boost/property_tree/json_parser.hpp&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;boost/property_tree/ptree.hpp&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;boost/property_tree/xml_parser.hpp&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;boost/serialization/export.hpp&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="predicates_8h.html">mpqc/util/meta/predicates.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="stream_8h.html">mpqc/util/meta/stream.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// serialize all pointers as void*</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// NB XCode 7.3.1 (7D1014) libc++ char stream does not properly deserialize</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// void*, use size_t instead</span></div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="namespaceboost.html">   32</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceboost.html">boost</a> {</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="namespaceboost_1_1property__tree.html">   33</a></span>&#160;<span class="keyword">namespace </span>property_tree {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Ch, <span class="keyword">typename</span> Traits, <span class="keyword">typename</span> E&gt;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html">   35</a></span>&#160;<span class="keyword">struct </span>customize_stream&lt;Ch, Traits, E*, <span class="keywordtype">void</span>&gt; {</div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#adb1869bcf09ffce48ef90a2e472d40eb">   36</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#adb1869bcf09ffce48ef90a2e472d40eb">stored_t</a> = size_t;  <span class="comment">// TODO convert to void* when it works</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  static_assert(<span class="keyword">sizeof</span>(<a class="code" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#adb1869bcf09ffce48ef90a2e472d40eb">stored_t</a>) == <span class="keyword">sizeof</span>(E*), <span class="stringliteral">&quot;expected ptr width&quot;</span>);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#a61e261a81b048794ca23dfd9db2cf971">   39</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#a61e261a81b048794ca23dfd9db2cf971">insert</a>(std::basic_ostream&lt;Ch, Traits&gt;&amp; s, <span class="keyword">const</span> E* e) {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">auto</span> flags = s.flags();</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    std::hex(s);  <span class="comment">// write as hexadecimal</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    std::showbase(s);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    s &lt;&lt; reinterpret_cast&lt;stored_t&gt;(e);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    s.setf(flags);  <span class="comment">// restore flags</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#a3d81a603febf5055bad2eae96dc25e6a">   46</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#a3d81a603febf5055bad2eae96dc25e6a">extract</a>(std::basic_istream&lt;Ch, Traits&gt;&amp; s, E*&amp; e) {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keyword">auto</span> flags = s.flags();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    std::hex(s);  <span class="comment">// read as hexadecimal</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    std::showbase(s);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#adb1869bcf09ffce48ef90a2e472d40eb">stored_t</a> e_stored;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    s &gt;&gt; e_stored;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    s.setf(flags);  <span class="comment">// restore flags</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    e = <span class="keyword">reinterpret_cast&lt;</span>E*<span class="keyword">&gt;</span>(e_stored);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (!s.eof()) {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      s &gt;&gt; std::ws;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;};</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}  <span class="comment">// namespace property_tree</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}  <span class="comment">// namespace boost</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacempqc.html">mpqc</a> {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">namespace </span>detail {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structmpqc_1_1detail_1_1register__keyval__ctor.html">   66</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structmpqc_1_1detail_1_1register__keyval__ctor.html">register_keyval_ctor</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespacempqc_1_1detail.html#a93f6db2b6ef4cae156a4fbae956136b0">guid</a>();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}  <span class="comment">// namespace detail</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keyword">class </span><a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">namespace </span>detail {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">class </span><a class="code" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html">SubTreeKeyVal</a>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}  <span class="comment">// namespace detail</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">class </span><a class="code" href="classmpqc_1_1_described_class.html">DescribedClass</a>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="namespacempqc.html#a44c41de87924d6fc1a88dc1943abab3c">   86</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespacempqc.html#a44c41de87924d6fc1a88dc1943abab3c">Describable</a> = std::is_base_of&lt;DescribedClass, T&gt;;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html">  117</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmpqc_1_1_described_class.html">DescribedClass</a> {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classmpqc_1_1_described_class.html#aaf8570443e0985afd7e99bd39769b881">DescribedClass</a>() = <span class="keywordflow">default</span>;</div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html#a870afa0e09720b6cea05f44de59fd668">  120</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="classmpqc_1_1_described_class.html#a870afa0e09720b6cea05f44de59fd668">~DescribedClass</a>() {}</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html#ad60555be0b13569893877d119d4b92b2">  123</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;DescribedClass&gt; (*keyval_ctor_wrapper_type)(</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp;);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keyword">static</span> <a class="code" href="classmpqc_1_1_described_class.html#ad60555be0b13569893877d119d4b92b2">keyval_ctor_wrapper_type</a> <a class="code" href="classmpqc_1_1_described_class.html#aa4b56eaba6efe5741ec1f7773504c590">type_to_keyval_ctor</a>(</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="keyword">const</span> std::string&amp; type_name);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html#a91c2eb064e67b1aeb3d6239566a14f15">  130</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_described_class.html#a91c2eb064e67b1aeb3d6239566a14f15">register_keyval_ctor</a>() {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* guid_T = mpqc::detail::guid&lt;T&gt;();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    assert(guid_T != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keyword">const</span> std::string type_name(guid_T);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keyword">auto</span>&amp; registry = keyval_ctor_registry_instance();</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    assert(registry.find(type_name) == registry.end());</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    registry.insert(std::make_pair(</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        type_name,</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        std::make_pair(keyval_ctor_wrapper&lt;T&gt;, std::cref(<span class="keyword">typeid</span>(T)))));</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html#a57120bc8692f1c8cb3159b4f13f2c91e">  147</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classmpqc_1_1_described_class.html#a57120bc8692f1c8cb3159b4f13f2c91e">is_registered</a>() {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; registry = keyval_ctor_registry_instance();</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; elem : registry) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">typeid</span>(T) == elem.second.second) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html#aa1bf13d01bb824d947469ab0dabf8324">  162</a></span>&#160;  <span class="keyword">static</span> std::string <a class="code" href="classmpqc_1_1_described_class.html#aa1bf13d01bb824d947469ab0dabf8324">class_key</a>() {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; registry = keyval_ctor_registry_instance();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; elem : registry) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">typeid</span>(T) == elem.second.second) <span class="keywordflow">return</span> elem.first;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span> std::string();</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html#a6dda7d6cf1cf1e6932d2851594f967b3">  175</a></span>&#160;  std::string <a class="code" href="classmpqc_1_1_described_class.html#a6dda7d6cf1cf1e6932d2851594f967b3">class_key</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; registry = keyval_ctor_registry_instance();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; elem : registry) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">typeid</span>(*<span class="keyword">this</span>) == elem.second.second) <span class="keywordflow">return</span> elem.first;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">return</span> std::string();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  template &lt;typename T, typename = std::enable_if_t&lt;Describable&lt;T&gt;::value&gt;&gt;</div><div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="structmpqc_1_1_described_class_1_1registrar.html">  191</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structmpqc_1_1_described_class_1_1registrar.html">registrar</a> {</div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="structmpqc_1_1_described_class_1_1registrar.html#ab79b7b0ce818020186b39d79afb60cb7">  192</a></span>&#160;    <a class="code" href="structmpqc_1_1_described_class_1_1registrar.html#ab79b7b0ce818020186b39d79afb60cb7">registrar</a>() { DescribedClass::register_keyval_ctor&lt;T&gt;(); }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  };</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keyword">using</span> keyval_ctor_registry_type =</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      std::map&lt;std::string,</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;               std::pair&lt;<a class="code" href="classmpqc_1_1_described_class.html#ad60555be0b13569893877d119d4b92b2">keyval_ctor_wrapper_type</a>,</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                         std::reference_wrapper&lt;const std::type_info&gt;&gt;&gt;;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">// this is needed to force registry initialization BEFORE its use</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keyword">static</span> keyval_ctor_registry_type&amp; keyval_ctor_registry_instance() {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keyword">static</span> keyval_ctor_registry_type keyval_ctor_registry_;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">return</span> keyval_ctor_registry_;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keyword">static</span> std::shared_ptr&lt;DescribedClass&gt; keyval_ctor_wrapper(<span class="keyword">const</span> KeyVal&amp; kv) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span> std::make_shared&lt;T&gt;(kv);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00214"></a><span class="lineno"><a class="line" href="classmpqc_1_1_described_class.html#ac0db7df2e202e9e3b522bb9357171584">  214</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> keyval_ctor_registry_type&amp; <a class="code" href="classmpqc_1_1_described_class.html#ac0db7df2e202e9e3b522bb9357171584">keyval_ctor_registry</a>() {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keyword">const </span>keyval_ctor_registry_type&amp;<span class="keyword">&gt;</span>(keyval_ctor_registry_instance());</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;};</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}  <span class="comment">// namespace mpqc</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="group___core_key_val.html#ga4652c5b1a9a85b1dfc01880a3ea10c2f">  226</a></span>&#160;<span class="preprocessor">#define MPQC_CLASS_REGISTER_GUID(K, ...) \</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">  namespace mpqc {                       \</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">  namespace detail {                     \</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="preprocessor">  template &lt;&gt;                            \</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">  const char* guid&lt;__VA_ARGS__&gt;() {      \</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="preprocessor">    return K;                            \</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor">  }                                      \</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">  } </span><span class="comment">/* detail */</span><span class="preprocessor">                         \</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">  } </span><span class="comment">/* mpqc */</span><span class="preprocessor">                           \</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="group___core_key_val.html#ga6c4a793e1de57c764a2f01c39e364a69">  243</a></span>&#160;<span class="preprocessor">#define MPQC_BOOST_CLASS_EXPORT_KEY2(K, ...)               \</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">  namespace boost {                                        \</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">  namespace serialization {                                \</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">  template &lt;&gt;                                              \</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">  struct guid_defined&lt;__VA_ARGS__&gt; : boost::mpl::true_ {}; \</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="preprocessor">  namespace ext {                                          \</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">  template &lt;&gt;                                              \</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">  struct guid_impl&lt;__VA_ARGS__&gt; {                          \</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">    static inline const char* call() { return K; }         \</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="preprocessor">  };                                                       \</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="preprocessor">  }                                                        \</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor">  } </span><span class="comment">/* serialization */</span><span class="preprocessor">                                    \</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="preprocessor">  } </span><span class="comment">/* boost */</span><span class="preprocessor">                                            \</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="group___core_key_val.html#gaed852023b22874529d5999bb2698e760">  267</a></span>&#160;<span class="preprocessor">#define MPQC_CLASS_EXPORT_KEY2(K, ...)                                         \</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">  MPQC_CLASS_REGISTER_GUID(K, __VA_ARGS__)                                     \</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="preprocessor">  namespace mpqc {                                                             \</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="preprocessor">  namespace detail {                                                           \</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="preprocessor">  template &lt;&gt;                                                                  \</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">  struct register_keyval_ctor&lt;__VA_ARGS__&gt; {                                   \</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor">    static DescribedClass::registrar&lt;__VA_ARGS__&gt; const&amp; r;                    \</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="preprocessor">  };                                                                           \</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="preprocessor">  DescribedClass::registrar&lt;__VA_ARGS__&gt; const&amp;                                \</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">      register_keyval_ctor&lt;__VA_ARGS__&gt;::r =                                   \</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">          ::boost::serialization::singleton&lt;                                   \</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="preprocessor">              DescribedClass::registrar&lt;__VA_ARGS__&gt;&gt;::get_mutable_instance(); \</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">  }                                                                            \</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="preprocessor">  }                                                                            \</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="group___core_key_val.html#ga51f6fa219f736d9823d14e4b44eee63f">  291</a></span>&#160;<span class="preprocessor">#define MPQC_CLASS_EXPORT_KEY(...) \</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">  MPQC_CLASS_EXPORT_KEY2(BOOST_PP_STRINGIZE(__VA_ARGS__), __VA_ARGS__)</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="group___core_key_val.html#gac2204ef81dabb828d11afcfbe3c71106">  301</a></span>&#160;<span class="preprocessor">#define MPQC_BOOST_CLASS_EXPORT_IMPLEMENT(...)                     \</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">  namespace boost {                                                \</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">  namespace archive {                                              \</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">  namespace detail {                                               \</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">  namespace extra_detail {                                         \</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">  template &lt;&gt;                                                      \</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">  struct init_guid&lt;__VA_ARGS__&gt; {                                  \</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">    static guid_initializer&lt;__VA_ARGS__&gt; const&amp; g;                 \</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">  };                                                               \</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor">  guid_initializer&lt;__VA_ARGS__&gt; const&amp; init_guid&lt;__VA_ARGS__&gt;::g = \</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor">      ::boost::serialization::singleton&lt;                           \</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">          guid_initializer&lt;__VA_ARGS__&gt;&gt;::get_mutable_instance()   \</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">          .export_guid();                                          \</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">  }                                                                \</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">  }                                                                \</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor">  }                                                                \</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="preprocessor">  }                                                                \</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">  </span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacempqc.html">mpqc</a> {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html">  350</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a> {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4">  356</a></span>&#160;  <span class="keyword">enum class</span> <a class="code" href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4">InputFormat</a> { <a class="code" href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4afedb2d84cafe20862cb4399751a8a7e3">invalid</a>, <a class="code" href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4a466deec76ecdf5fca6d38571f6324d54">json</a>, <a class="code" href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4a0f635d0e0f3874fff8b581c132e6c7a7">xml</a>, <a class="code" href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4acaf9b6b99962bf5c2264824231d7a40c">info</a> };</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">  359</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a> = boost::property_tree::iptree;</div><div class="line"><a name="l00360"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">  360</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a> = ptree::key_type;     <span class="comment">// = std::string</span></div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">  361</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">value_type</a> = ptree::data_type;  <span class="comment">// = std::string</span></div><div class="line"><a name="l00362"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#ae287fb3c07e957abba5b38fb9550128a">  362</a></span>&#160;  constexpr <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="classmpqc_1_1_key_val.html#ae287fb3c07e957abba5b38fb9550128a">separator</a> = <span class="charliteral">&#39;:&#39;</span>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a5246dff976d813166548b2e3782b2dd7">  366</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classmpqc_1_1_key_val.html#a5246dff976d813166548b2e3782b2dd7">throw_if_deprecated_path</a>() {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">return</span> throw_if_deprecated_path_accessor();</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  }</div><div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#adb280f12507d346648c0ed5b748a4aa2">  371</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_key_val.html#adb280f12507d346648c0ed5b748a4aa2">set_throw_if_deprecated_path</a>(<span class="keywordtype">bool</span> f) {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    throw_if_deprecated_path_accessor() = f;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span>&amp; throw_if_deprecated_path_accessor() {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Class&gt;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keyword">struct </span>is_sequence : std::false_type {};</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> A&gt;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keyword">struct </span>is_sequence&lt;<a class="code" href="namespacestd.html">std</a>::vector&lt;T, A&gt;&gt; : std::true_type {};</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, std::<span class="keywordtype">size_t</span> N&gt;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">struct </span>is_sequence&lt;<a class="code" href="namespacestd.html">std</a>::array&lt;T, N&gt;&gt; : std::true_type {};</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> A&gt;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keyword">struct </span>is_sequence&lt;<a class="code" href="namespacestd.html">std</a>::list&lt;T, A&gt;&gt; : std::true_type {};</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, std::<span class="keywordtype">size_t</span> N&gt;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> resize(std::array&lt;T, N&gt;&amp; container, std::size_t size) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    assert(size &lt;= N);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> resize(T&amp; container, std::size_t size) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    container.resize(size);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> SequenceContainer&gt;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a> make_ptree(</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keyword">const</span> SequenceContainer&amp; <a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a>, <span class="keywordtype">bool</span> json_style = <span class="keyword">true</span>,</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      std::enable_if_t&lt;KeyVal::is_sequence&lt;SequenceContainer&gt;::value&gt;* =</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a> result;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="classmpqc_1_1_key_val.html#a32a637d5baad1c583252aad02015326b">count</a> = 0;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : <a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a>) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keyword">auto</span> <a class="code" href="namespaceparse__nist__41.html#a84786d9cd3835f04f9d6044ba97efe4a">key</a> =</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          json_style</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;              ? <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>(<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;              : <a class="code" href="namespacestd.html">std</a>::<a class="code" href="group___init.html#ga40d388c6444549a58471f357f5d21995">to_string</a>(<a class="code" href="classmpqc_1_1_key_val.html#a32a637d5baad1c583252aad02015326b">count</a>);  <span class="comment">// assumes key_type == std::string</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a> pt = make_ptree(v, json_style);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      result.push_back(std::make_pair(<a class="code" href="namespaceparse__nist__41.html#a84786d9cd3835f04f9d6044ba97efe4a">key</a>, pt));</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      ++<a class="code" href="classmpqc_1_1_key_val.html#a32a637d5baad1c583252aad02015326b">count</a>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  std::enable_if_t&lt;!KeyVal::is_sequence&lt;T&gt;::value &amp;&amp;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                       !<a class="code" href="classmpqc_1_1utility_1_1meta_1_1can__construct.html#aa157a44bece13521bd5c226bb28ba126">utility::meta::can_construct&lt;T, const KeyVal&amp;&gt;::value</a>,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                   <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a>&gt;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  make_ptree(<span class="keyword">const</span> T&amp; <a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a>, <span class="keywordtype">bool</span>) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a> result;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    result.put(<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a>);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  boost::optional&lt;size_t&gt; count_impl(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; abs_path)<span class="keyword"> const </span>{</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keyword">auto</span> child_opt =</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        top_tree_-&gt;get_child_optional(ptree::path_type{abs_path, <a class="code" href="classmpqc_1_1_key_val.html#ae287fb3c07e957abba5b38fb9550128a">separator</a>});</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">if</span> (child_opt == boost::optional&lt;ptree&amp;&gt;())</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">return</span> boost::optional&lt;size_t&gt;{};</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">return</span> child_opt-&gt;size();</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">KeyVal</a>();</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">KeyVal</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">KeyVal</a>&amp; <a class="code" href="group___chemistry_e_s_spin.html#ga28cc62c8097e7422638945411208bbd2">other</a>) = <span class="keywordflow">default</span>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">KeyVal</a>&amp; <a class="code" href="classmpqc_1_1_key_val.html#a89c571756cc385fe4199dc7260421a6b">operator=</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">KeyVal</a>&amp; <a class="code" href="group___chemistry_e_s_spin.html#ga28cc62c8097e7422638945411208bbd2">other</a>) = <span class="keywordflow">default</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">KeyVal</a> <a class="code" href="classmpqc_1_1_key_val.html#a9d19d7373b0ffa6ad3d029d5352f16a9">clone</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a013e32435b4fbc49c5c20ea74dd6fa26">  499</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a> <a class="code" href="classmpqc_1_1_key_val.html#a013e32435b4fbc49c5c20ea74dd6fa26">keyval</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; <a class="code" href="classmpqc_1_1_key_val.html#a00f44def7e5382ec9c1994efdbb71173">path</a>)<span class="keyword"> const </span>{</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keyword">auto</span> abs_path = resolve_path(<a class="code" href="classmpqc_1_1_key_val.html#a00f44def7e5382ec9c1994efdbb71173">path</a>);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">KeyVal</a>(top_tree_, dc_registry_, default_class_key_, abs_path);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#afd9c1e39d18333127017d59879fe382f">  505</a></span>&#160;  std::shared_ptr&lt;ptree&gt; <a class="code" href="classmpqc_1_1_key_val.html#afd9c1e39d18333127017d59879fe382f">top_tree</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> top_tree_; }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  std::shared_ptr&lt;ptree&gt; <a class="code" href="classmpqc_1_1_key_val.html#ab32d9e717a274d228dec0a509ace84c2">tree</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  template &lt;typename T, typename = std::enable_if_t&lt;Describable&lt;T&gt;::value&gt;&gt;</div><div class="line"><a name="l00515"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a75fa7e0ea9e39797bf99b9815f70d19f">  515</a></span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp; <a class="code" href="classmpqc_1_1_key_val.html#a75fa7e0ea9e39797bf99b9815f70d19f">set_default_class_key</a>(<span class="keyword">const</span> std::string&amp; <a class="code" href="namespaceparse__nist__41.html#a84786d9cd3835f04f9d6044ba97efe4a">key</a>) {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    (*default_class_key_)[<span class="keyword">typeid</span>(T).hash_code()] = <a class="code" href="namespaceparse__nist__41.html#a84786d9cd3835f04f9d6044ba97efe4a">key</a>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a47b3acf9305b2b0c758b9e3821b13301">  525</a></span>&#160;  std::string <a class="code" href="classmpqc_1_1_key_val.html#a47b3acf9305b2b0c758b9e3821b13301">default_class_key</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keyword">auto</span> it = default_class_key_-&gt;find(<span class="keyword">typeid</span>(T).hash_code());</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">if</span> (it != default_class_key_-&gt;end())</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">return</span> it-&gt;second;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">return</span> std::string{};</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a9bf3726bba5b069e5f7aaaf2fef6ee28">  536</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classmpqc_1_1_key_val.html#a9bf3726bba5b069e5f7aaaf2fef6ee28">exists</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    std::string resolved_path;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordtype">bool</span> bad_path = <span class="keyword">false</span>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      resolved_path = resolve_path(path);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    } <span class="keywordflow">catch</span> (<a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>&amp;) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      bad_path = <span class="keyword">true</span>;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">return</span> bad_path ? false : exists_(resolved_path);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a2602c29e5878d0e060eba4d9fd8f0491">  551</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classmpqc_1_1_key_val.html#a2602c29e5878d0e060eba4d9fd8f0491">exists_class</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">bool</span> exists_class_ptr = <span class="keyword">false</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keyword">auto</span> iter = dc_registry_-&gt;find(resolve_path(path));</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span> (iter != dc_registry_-&gt;end()) {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keyword">auto</span> weak_ptr = iter-&gt;second;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="comment">// if have unexpired cached ptr report true, otherwise false (and purge</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="comment">// the expired ptr)</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">if</span> (weak_ptr.expired())</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        dc_registry_-&gt;erase(iter);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        exists_class_ptr = <span class="keyword">true</span>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">return</span> exists_class_ptr;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a32a637d5baad1c583252aad02015326b">  571</a></span>&#160;  boost::optional&lt;size_t&gt; <a class="code" href="classmpqc_1_1_key_val.html#a32a637d5baad1c583252aad02015326b">count</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keyword">auto</span> abs_path = resolve_path(path);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> count_impl(abs_path);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keyword">typename</span> = std::enable_if_t&lt;not KeyVal::is_sequence&lt;T&gt;::value&gt;&gt;</div><div class="line"><a name="l00582"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a6eff3369d0958de41d78da924c3d6263">  582</a></span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp; <a class="code" href="classmpqc_1_1_key_val.html#a6eff3369d0958de41d78da924c3d6263">assign</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path, <span class="keyword">const</span> T&amp; value) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keyword">auto</span> abs_path = to_absolute_path(path);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    top_tree_-&gt;put(ptree::path_type{abs_path, separator}, value);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> SequenceContainer&gt;</div><div class="line"><a name="l00605"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a71722c4844b4b602dbe14bd14a5fffba">  605</a></span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp; <a class="code" href="classmpqc_1_1_key_val.html#a71722c4844b4b602dbe14bd14a5fffba">assign</a>(</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path, <span class="keyword">const</span> SequenceContainer&amp; value,</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="keywordtype">bool</span> json_style = <span class="keyword">true</span>,</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      std::enable_if_t&lt;KeyVal::is_sequence&lt;SequenceContainer&gt;::value&gt;* =</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keyword">auto</span> abs_path = to_absolute_path(path);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a> obj = make_ptree(value, json_style);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    top_tree_-&gt;add_child(ptree::path_type{abs_path, separator}, obj);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T = <a class="code" href="classmpqc_1_1_described_class.html">DescribedClass</a>,</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keyword">typename</span> = std::enable_if_t&lt;Describable&lt;T&gt;::value&gt;&gt;</div><div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a2dd4fb13cb0b2c30dfd9b992764e23a4">  625</a></span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp; <a class="code" href="classmpqc_1_1_key_val.html#a2dd4fb13cb0b2c30dfd9b992764e23a4">assign</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path, <span class="keyword">const</span> std::shared_ptr&lt;T&gt;&amp; value) {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keyword">auto</span> dc_value = std::static_pointer_cast&lt;<a class="code" href="classmpqc_1_1_described_class.html">DescribedClass</a>&gt;(value);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    std::weak_ptr&lt;DescribedClass&gt; weak_value = dc_value;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keyword">auto</span> abs_path = to_absolute_path(path);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    (*dc_registry_)[abs_path] = weak_value;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a1967495bff6a013f3de037cec1b626d0">  635</a></span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp; <a class="code" href="classmpqc_1_1_key_val.html#a1967495bff6a013f3de037cec1b626d0">erase</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keyword">auto</span> abs_path = resolve_path(path);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a> abs_path_basename, name;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    std::tie(abs_path_basename, name) = path_basename(abs_path);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    top_tree_-&gt;get_child(ptree::path_type{abs_path_basename, separator})</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        .erase(name);  <span class="comment">// count is ignored</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  }</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="comment">// validators</span></div><div class="line"><a name="l00645"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1dummy__validator__t.html">  645</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structmpqc_1_1_key_val_1_1dummy__validator__t.html">dummy_validator_t</a> {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div><div class="line"><a name="l00647"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1dummy__validator__t.html#a02ff6324704e16ff704e48ff3777788b">  647</a></span>&#160;    constexpr <span class="keywordtype">bool</span> <a class="code" href="structmpqc_1_1_key_val_1_1dummy__validator__t.html#a02ff6324704e16ff704e48ff3777788b">operator()</a>(Args&amp;&amp;... args)<span class="keyword"> const </span>{</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  };</div><div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a233478739c879017e9768c6c44d68e8f">  651</a></span>&#160;  <span class="keyword">static</span> constexpr <a class="code" href="structmpqc_1_1_key_val_1_1dummy__validator__t.html">dummy_validator_t</a> dummy_validator{};</div><div class="line"><a name="l00652"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1is__nonnegative__t.html">  652</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structmpqc_1_1_key_val_1_1is__nonnegative__t.html">is_nonnegative_t</a> {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Arg&gt;</div><div class="line"><a name="l00654"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1is__nonnegative__t.html#a755f03246bfb4bd6b85d98054dc33d0e">  654</a></span>&#160;    constexpr <span class="keywordtype">bool</span> <a class="code" href="structmpqc_1_1_key_val_1_1is__nonnegative__t.html#a755f03246bfb4bd6b85d98054dc33d0e">operator()</a>(Arg&amp;&amp; arg)<span class="keyword"> const </span>{</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">return</span> arg &gt;= 0;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  };</div><div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a60d929c7b336d452e1d1f38fe88729f2">  658</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structmpqc_1_1_key_val_1_1is__nonnegative__t.html">is_nonnegative_t</a> <a class="code" href="classmpqc_1_1_key_val.html#a60d929c7b336d452e1d1f38fe88729f2">is_nonnegative</a>;</div><div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1is__positive__t.html">  659</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structmpqc_1_1_key_val_1_1is__positive__t.html">is_positive_t</a> {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Arg&gt;</div><div class="line"><a name="l00661"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1is__positive__t.html#adbcf3bb38bc8b9d8284962b065e2de82">  661</a></span>&#160;    constexpr <span class="keywordtype">bool</span> <a class="code" href="structmpqc_1_1_key_val_1_1is__positive__t.html#adbcf3bb38bc8b9d8284962b065e2de82">operator()</a>(Arg&amp;&amp; arg)<span class="keyword"> const </span>{</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">return</span> arg &gt; 0;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  };</div><div class="line"><a name="l00665"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a7b191e01f96e5809ac4fb2d8dce0bd56">  665</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structmpqc_1_1_key_val_1_1is__positive__t.html">is_positive_t</a> <a class="code" href="classmpqc_1_1_key_val.html#a7b191e01f96e5809ac4fb2d8dce0bd56">is_positive</a>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Validator = <a class="code" href="structmpqc_1_1_key_val_1_1dummy__validator__t.html">dummy_validator_t</a>,</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="keyword">typename</span> = std::enable_if_t&lt;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                not KeyVal::is_sequence&lt;T&gt;::value &amp;&amp;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                not <a class="code" href="classmpqc_1_1utility_1_1meta_1_1can__construct.html">utility::meta::can_construct&lt;T, const KeyVal&amp;&gt;::value</a> &amp;&amp;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                std::is_same&lt;bool, decltype(std::declval&lt;Validator&gt;()(</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                                       std::declval&lt;const T&amp;&gt;()))&gt;::value&gt;&gt;</div><div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">  687</a></span>&#160;  T <a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path, Validator&amp;&amp; validator = Validator{}) <span class="keyword">const</span> {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    T result;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> subtree = this-&gt;get_subtree(path)) {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        result = (*subtree).get_value&lt;T&gt;();</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">throw</span> KeyVal::bad_input(std::string(<span class="stringliteral">&quot;path not found&quot;</span>),</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                to_absolute_path(path));</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    } <span class="keywordflow">catch</span> (boost::property_tree::ptree_bad_data&amp; x) {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">throw</span> KeyVal::bad_input(</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;          std::string(<span class="stringliteral">&quot;value &quot;</span>) + x.data&lt;<a class="code" href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">KeyVal::value_type</a>&gt;() +</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;              <span class="stringliteral">&quot; could not be converted to the desired datatype&quot;</span>,</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          to_absolute_path(path));</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (validator(result) == <span class="keyword">false</span>) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      std::ostringstream oss;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      oss &lt;&lt; <span class="stringliteral">&quot;value &quot;</span> &lt;&lt; result &lt;&lt; <span class="stringliteral">&quot; did not pass validation&quot;</span>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">throw</span> KeyVal::bad_input(oss.str(), to_absolute_path(path));</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Val<span class="keywordtype">id</span>ator = dummy_val<span class="keywordtype">id</span>ator_t&gt;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  std::enable_if_t&lt;not KeyVal::is_sequence&lt;T&gt;::value &amp;&amp;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                       <a class="code" href="classmpqc_1_1utility_1_1meta_1_1can__construct.html#aa157a44bece13521bd5c226bb28ba126">utility::meta::can_construct&lt;T, const KeyVal&amp;&gt;::value</a> &amp;&amp;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                       std::is_same&lt;bool, decltype(std::declval&lt;Validator&gt;()(</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                                              std::declval&lt;const T&amp;&gt;()))&gt;::value,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                   T&gt;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  value(<span class="keyword">const</span> key_type&amp; path, Validator&amp;&amp; validator = Validator{}) <span class="keyword">const</span>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> SequenceContainer, <span class="keyword">typename</span> Val<span class="keywordtype">id</span>ator = dummy_val<span class="keywordtype">id</span>ator_t&gt;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  SequenceContainer value(</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="keyword">const</span> key_type&amp; path, Validator&amp;&amp; validator = Validator{},</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      std::enable_if_t&lt;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;          KeyVal::is_sequence&lt;SequenceContainer&gt;::value &amp;&amp;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          std::is_same&lt;bool, decltype(std::declval&lt;Validator&gt;()(</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                                 std::declval&lt;<span class="keyword">const</span> <span class="keyword">typename</span> SequenceContainer::</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                                  value_type&amp;&gt;()))&gt;::value&gt;* =</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          <span class="keyword">nullptr</span>) <span class="keyword">const</span>;  <span class="comment">// implemented after SubTreeKeyval is implemented</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Validator = dummy_validator_t,</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="keyword">typename</span> = std::enable_if_t&lt;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                not KeyVal::is_sequence&lt;T&gt;::value &amp;&amp;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                std::is_same&lt;bool, decltype(std::declval&lt;Validator&gt;()(</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                       std::declval&lt;const T&amp;&gt;()))&gt;::value&gt;&gt;</div><div class="line"><a name="l00771"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a5ab3182385ef098f63732757c676fe7c">  771</a></span>&#160;  T <a class="code" href="classmpqc_1_1_key_val.html#a5ab3182385ef098f63732757c676fe7c">value</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path, <span class="keyword">const</span> T&amp; default_value,</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          <span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; deprecated_path,</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;          Validator&amp;&amp; validator = Validator{}) <span class="keyword">const</span> {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    T result = default_value;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keyword">const</span> key_type* read_path = &amp;path;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keyword">auto</span> subtree = this-&gt;get_subtree(path);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (!path.empty() &amp;&amp; subtree) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      result = (*subtree).template get_value&lt;T&gt;(default_value);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!deprecated_path.empty() &amp;&amp;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;               (subtree = this-&gt;get_subtree(deprecated_path))) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      read_path = &amp;deprecated_path;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keyword">auto</span> result_optional = subtree.get().template get_value_optional&lt;T&gt;();</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">if</span> (result_optional) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        result = *result_optional;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classmpqc_1_1_key_val.html#a5246dff976d813166548b2e3782b2dd7">KeyVal::throw_if_deprecated_path</a>()) {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          std::ostringstream oss;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;          oss &lt;&lt; <span class="stringliteral">&quot;KeyVal read value from deprecated path&quot;</span>;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          <span class="keywordflow">throw</span> KeyVal::bad_input(oss.str(), to_absolute_path(*read_path));</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;          std::cerr &lt;&lt; <span class="stringliteral">&quot;KeyVal read value from deprecated path &quot;</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                    &lt;&lt; to_absolute_path(*read_path) &lt;&lt; std::endl;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span> (validator(result) == <span class="keyword">false</span>) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      std::ostringstream oss;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      oss &lt;&lt; <span class="stringliteral">&quot;value &quot;</span> &lt;&lt; result &lt;&lt; <span class="stringliteral">&quot; did not pass validation&quot;</span>;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keywordflow">throw</span> KeyVal::bad_input(oss.str(), to_absolute_path(*read_path));</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Validator = dummy_validator_t,</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <span class="keyword">typename</span> = std::enable_if_t&lt;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                not KeyVal::is_sequence&lt;T&gt;::value &amp;&amp;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                std::is_same&lt;bool, decltype(std::declval&lt;Validator&gt;()(</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                       std::declval&lt;const T&amp;&gt;()))&gt;::value&gt;&gt;</div><div class="line"><a name="l00821"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a645729e75db76c2b8d1d871345d0d01f">  821</a></span>&#160;  T <a class="code" href="classmpqc_1_1_key_val.html#a645729e75db76c2b8d1d871345d0d01f">value</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path, <span class="keyword">const</span> T&amp; default_value,</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;          Validator&amp;&amp; validator = Validator{}) <span class="keyword">const</span> {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    T result = default_value;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> subtree = this-&gt;get_subtree(path)) {</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      result = (*subtree).template get_value&lt;T&gt;(default_value);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">if</span> (validator(result) == <span class="keyword">false</span>) {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      std::ostringstream oss;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      oss &lt;&lt; <span class="stringliteral">&quot;value &quot;</span> &lt;&lt; result &lt;&lt; <span class="stringliteral">&quot; did not pass validation&quot;</span>;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keywordflow">throw</span> KeyVal::bad_input(oss.str(), to_absolute_path(path));</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    }</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T = DescribedClass,</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <span class="keyword">typename</span> = std::enable_if_t&lt;Describable&lt;T&gt;::value&gt;&gt;</div><div class="line"><a name="l00865"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#af1e398eb00a68455ba539ecac59d0716">  865</a></span>&#160;  std::shared_ptr&lt;T&gt; <a class="code" href="classmpqc_1_1_key_val.html#af1e398eb00a68455ba539ecac59d0716">class_ptr</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path = <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>(),</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                               <span class="keywordtype">bool</span> bypass_registry = <span class="keyword">false</span>,</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                               <span class="keywordtype">bool</span> disable_bad_input = <span class="keyword">false</span>)<span class="keyword"> const </span>{</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="comment">// if this class already exists in the registry under path</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="comment">// (e.g. if the ptr was assigned programmatically), return immediately</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> (!bypass_registry) {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <span class="keyword">auto</span> it = dc_registry_-&gt;find(path);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordflow">if</span> (it != dc_registry_-&gt;end()) {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="comment">// if have unexpired weak ptr, convert to shared and return</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keyword">auto</span> weak_ptr = it-&gt;second;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">if</span> (!weak_ptr.expired())</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          <span class="keywordflow">return</span> std::dynamic_pointer_cast&lt;T&gt;(weak_ptr.lock());</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="comment">// otherwise, resolve the path and build the class (or pick up the cached</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">// copy)</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keyword">auto</span> abs_path = resolve_path(path);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">// if this class already exists, return the ptr</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">if</span> (!bypass_registry) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keyword">auto</span> it = dc_registry_-&gt;find(abs_path);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keywordflow">if</span> (it != dc_registry_-&gt;end()) {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="comment">// if have unexpired weak ptr, convert to shared and return</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keyword">auto</span> weak_ptr = it-&gt;second;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordflow">if</span> (!weak_ptr.expired())</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;          <span class="keywordflow">return</span> std::dynamic_pointer_cast&lt;T&gt;(weak_ptr.lock());</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="comment">// return nullptr if the path does not exist, or does not point to an aggregate</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">if</span> (!this-&gt;exists_(abs_path) || !<span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(this-&gt;count_impl(abs_path))) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keywordflow">return</span> std::shared_ptr&lt;T&gt;();</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    }</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="comment">// compute the type name of the constructed object</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    std::string result_type_name;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keyword">auto</span> type_path = concat_path(abs_path, <span class="stringliteral">&quot;type&quot;</span>);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">if</span> (not exists_(type_path)) {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="comment">// check if default type value had been given for this T</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      std::string default_type_str = this-&gt;default_class_key&lt;T&gt;();</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">if</span> (!default_type_str.empty())</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        result_type_name = default_type_str;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="comment">// no user override for type = try to construct T</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::is_abstract&lt;T&gt;::value) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">if</span> (disable_bad_input) <span class="keywordflow">return</span> std::shared_ptr&lt;T&gt;();</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            std::string(</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                <span class="stringliteral">&quot;KeyVal::class_ptr&lt;T&gt;(): T is an abstract class, &quot;</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                <span class="stringliteral">&quot;hence keyword \&quot;type\&quot; must be given for object at path &quot;</span> +</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                path),</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            abs_path);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!DescribedClass::is_registered&lt;T&gt;()) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">if</span> (disable_bad_input) <span class="keywordflow">return</span> std::shared_ptr&lt;T&gt;();</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            std::string(</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                <span class="stringliteral">&quot;KeyVal::class_ptr&lt;T&gt;(): T is an unregistered concrete class, &quot;</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                <span class="stringliteral">&quot;hence keyword \&quot;type\&quot; must be given for object at path &quot;</span> +</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                path),</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            abs_path);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      }</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        result_type_name = DescribedClass::class_key&lt;T&gt;();</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// user provided \&quot;type\&quot; keyword, use it to override the type</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      result_type_name =</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;          top_tree_-&gt;get&lt;std::string&gt;(ptree::path_type{type_path, separator});</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">// map class type to its ctor</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keyword">auto</span> ctor = <a class="code" href="classmpqc_1_1_described_class.html#aa4b56eaba6efe5741ec1f7773504c590">DescribedClass::type_to_keyval_ctor</a>(result_type_name);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">// call the ctor</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="comment">// if nonempty path, construct a KeyVal object rooted at that path,</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="comment">// otherwise use self</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keyword">auto</span> result = !path.empty() ? (*ctor)(this-&gt;keyval(path)) : (*ctor)(*this);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">if</span> (!bypass_registry) (*dc_registry_)[abs_path] = result;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">return</span> std::dynamic_pointer_cast&lt;T&gt;(result);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  }</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a6a75b3737bba3d139cba7f2d0810f80b">  952</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_key_val.html#a6a75b3737bba3d139cba7f2d0810f80b">write_xml</a>(std::basic_ostream&lt;typename key_type::value_type&gt;&amp; os)<span class="keyword"> const </span>{</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    boost::property_tree::xml_parser::write_xml(os, *(tree()));</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  }</div><div class="line"><a name="l00956"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a78a81ca8f160b9d54411505140ab8b06">  956</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_key_val.html#a78a81ca8f160b9d54411505140ab8b06">read_xml</a>(std::basic_istream&lt;typename key_type::value_type&gt;&amp; is) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    boost::property_tree::xml_parser::read_xml(is, *(tree()));</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  }</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a8da9a1a8d026e992d5941d1929cc7726">  961</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_key_val.html#a8da9a1a8d026e992d5941d1929cc7726">write_json</a>(std::basic_ostream&lt;key_type::value_type&gt;&amp; os)<span class="keyword"> const </span>{</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    boost::property_tree::json_parser::write_json(os, *(tree()));</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  }</div><div class="line"><a name="l00965"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a3d0de8f5c809cbe7719ca54737a9ec35">  965</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_key_val.html#a3d0de8f5c809cbe7719ca54737a9ec35">read_json</a>(std::basic_istream&lt;key_type::value_type&gt;&amp; is) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    boost::property_tree::json_parser::read_json(is, *(tree()));</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  }</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a88bd8bd53608a85bfcb9827ca9959278">  970</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_key_val.html#a88bd8bd53608a85bfcb9827ca9959278">write_info</a>(std::basic_ostream&lt;typename key_type::value_type&gt;&amp; os)<span class="keyword"> const </span>{</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    boost::property_tree::info_parser::write_info(os, *(tree()));</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  }</div><div class="line"><a name="l00974"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a0a1184277466a6d293987d573d027d82">  974</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classmpqc_1_1_key_val.html#a0a1184277466a6d293987d573d027d82">read_info</a>(std::basic_istream&lt;typename key_type::value_type&gt;&amp; is) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    boost::property_tree::info_parser::read_info(is, *(tree()));</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a00f44def7e5382ec9c1994efdbb71173">  980</a></span>&#160;  std::string <a class="code" href="classmpqc_1_1_key_val.html#a00f44def7e5382ec9c1994efdbb71173">path</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> path_; }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  std::shared_ptr&lt;ptree&gt; top_tree_;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">// &#39;dc&#39; = DescribedClass</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keyword">using</span> dc_registry_type = std::map&lt;std::string, std::weak_ptr&lt;DescribedClass&gt;&gt;;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  std::shared_ptr&lt;dc_registry_type&gt; dc_registry_;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keyword">const</span> key_type path_;  </div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keyword">using</span> dck_registry_type = std::map&lt;std::size_t, std::string&gt;;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  std::shared_ptr&lt;dck_registry_type&gt; default_class_key_;  <span class="comment">// maps typeid(T).hash_code() to the corresponding class key to use by default</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>(<span class="keyword">const</span> std::shared_ptr&lt;ptree&gt;&amp; top_tree,</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;         <span class="keyword">const</span> std::shared_ptr&lt;dc_registry_type&gt;&amp; dc_registry,</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;         <span class="keyword">const</span> std::shared_ptr&lt;dck_registry_type&gt;&amp; dck_registry,</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;         <span class="keyword">const</span> key_type&amp; path)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      : top_tree_(top_tree), dc_registry_(dc_registry), path_(path), default_class_key_(dck_registry) {}</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  KeyVal(ptree pt)</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      : KeyVal(<a class="code" href="namespacestd.html">std</a>::make_shared&lt;ptree&gt;(<a class="code" href="namespacestd.html">std</a>::move(pt)), <a class="code" href="namespacestd.html">std</a>::make_shared&lt;dc_registry_type&gt;(), <a class="code" href="namespacestd.html">std</a>::make_shared&lt;dck_registry_type&gt;(), <span class="stringliteral">&quot;&quot;</span>) {}</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keyword">static</span> key_type realpath(<span class="keyword">const</span> key_type&amp; path) {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    key_type result = path;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keyword">const</span> key_type parent_token(<span class="stringliteral">&quot;..&quot;</span>);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keyword">auto</span> parent_token_location = result.find(parent_token);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordflow">while</span> (parent_token_location != key_type::npos) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="comment">// make sure .. is preceeded by :</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <span class="keywordflow">if</span> (parent_token_location == 0)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keywordflow">throw</span> KeyVal::bad_input(</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <span class="stringliteral">&quot;KeyVal: reference path cannot begin with \&quot;..\&quot;&quot;</span>, path);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordflow">if</span> (path[parent_token_location - 1] != separator)</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="keywordflow">throw</span> KeyVal::bad_input(</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            std::string(</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                <span class="stringliteral">&quot;KeyVal: \&quot;..\&quot; in reference path must be preceeded by \&quot;&quot;</span>) +</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                separator + <span class="stringliteral">&quot;\&quot;&quot;</span>,</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            path);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="comment">// did we find &#39;..:&#39; or &#39;..\0&#39;?</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keyword">auto</span> parent_token_length =</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;          (result.find(separator, parent_token_location + 1) ==</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;           parent_token_location + 2)</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;              ? 3</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;              : 2;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="comment">// find the beginning of the preceding path element</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="comment">// NB handle the corner case of path starting with &quot;:..&quot;</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keyword">auto</span> preceding_token_location =</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;          parent_token_location &gt; 1</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;              ? path.rfind(separator, parent_token_location - 2)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;              : 0;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="keywordflow">if</span> (preceding_token_location == key_type::npos)  <span class="comment">// if separator not</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                                                       <span class="comment">// found, the preceeding</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                                                       <span class="comment">// element is the</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                                                       <span class="comment">// beginning of the path</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        preceding_token_location = 0;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      result.erase(preceding_token_location,</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                   (parent_token_location + parent_token_length -</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                    preceding_token_location));</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      parent_token_location = result.find(parent_token);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keyword">static</span> key_type to_absolute_path(<span class="keyword">const</span> key_type&amp; path_prefix,</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                                   <span class="keyword">const</span> key_type&amp; path) {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keyword">auto</span> is_ref = path.size() != 0 &amp;&amp; path[0] == <span class="charliteral">&#39;$&#39;</span>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keyword">auto</span> is_abs_ref = is_ref &amp;&amp; path.size() &gt; 1 &amp;&amp; path[1] == <span class="charliteral">&#39;:&#39;</span>;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    key_type abs_path;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    key_type path_copy = path;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keywordflow">if</span> (is_abs_ref) {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      abs_path = path_copy.substr(2);  <span class="comment">// drop the leading &quot;$:&quot;</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      key_type rel_path =</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;          is_ref ? path_copy.substr(1) : path_copy;  <span class="comment">// drop the leading &quot;$&quot;</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      abs_path = concat_path(path_prefix, rel_path);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    }</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    abs_path = realpath(abs_path);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">return</span> abs_path;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  key_type to_absolute_path(<span class="keyword">const</span> key_type&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">return</span> to_absolute_path(path_, path);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  }</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keyword">static</span> key_type concat_path(<span class="keyword">const</span> key_type&amp; prefix, <span class="keyword">const</span> key_type&amp; postfix) {</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="comment">// if (postfix.size() &gt; 0) assert(postfix[0] != separator);</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keyword">auto</span> result =</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        (postfix == <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            ? prefix</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            : ((prefix == <span class="stringliteral">&quot;&quot;</span>) ? postfix : prefix + separator + postfix);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  }</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  key_type resolve_path(<span class="keyword">const</span> key_type&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keyword">auto</span> abs_path = to_absolute_path(path);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keyword">auto</span> result = resolve_refs(abs_path);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  key_type resolve_refs(<span class="keyword">const</span> key_type&amp; path, <span class="keywordtype">size_t</span> niter_max = 10)<span class="keyword"> const </span>{</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    key_type result = path;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordtype">size_t</span> niter = 0;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordflow">while</span> (niter &lt; niter_max) {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keywordtype">bool</span> done = resolve_first_ref(result);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">if</span> (done) <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      ++niter;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">// too many iterations if still here</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">throw</span> KeyVal::bad_input(<span class="stringliteral">&quot;excessive or circular references in path&quot;</span>, path);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keywordtype">bool</span> resolve_first_ref(key_type&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">if</span> (path.size() == 0)</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// handle this corner case now to make the rest a bit</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                    <span class="comment">// cleaner</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keyword">auto</span> subpath_last_char = path.find(</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        separator, 1);  <span class="comment">// if path starts &quot;:&quot; no need to check root of the tree</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="keywordflow">if</span> (subpath_last_char == key_type::npos)</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      subpath_last_char =</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;          path.size();  <span class="comment">// this ensures that the full path is checked</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">while</span> (subpath_last_char &lt;= path.size()) {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <span class="keyword">auto</span> subpath = path.substr(0, subpath_last_char);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="keywordflow">if</span> (!exists_(subpath)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="keyword">auto</span> value = top_tree_-&gt;get&lt;key_type&gt;(ptree::path_type{</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;          subpath, separator});  <span class="comment">// value corresponding to subpath</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keyword">auto</span> subpath_is_a_ref = (value.size() &gt; 0 &amp;&amp; value[0] == <span class="charliteral">&#39;$&#39;</span>);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">if</span> (subpath_is_a_ref) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="comment">// resolve subpath key + value to a new subpath</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="keyword">auto</span> subpath_base = path_pop(subpath);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keyword">auto</span> new_subpath = to_absolute_path(subpath_base, value);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="comment">// replace the old subpath with the new subpath</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        path = new_subpath + path.substr(subpath.size());</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keywordflow">if</span> (subpath_last_char ==</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;          path.size())  <span class="comment">// subpath = path and it&#39;s not a ref? done</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      subpath_last_char = path.find(separator, subpath_last_char + 1);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="keywordflow">if</span> (subpath_last_char == key_type::npos)</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        subpath_last_char =</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            path.size();  <span class="comment">// this ensures that the full path is checked</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// no refs found</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  }</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keyword">static</span> key_type path_pop(<span class="keyword">const</span> key_type&amp; path) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    key_type result = path;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keyword">auto</span> last_separator_location = result.rfind(separator);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (last_separator_location == key_type::npos) last_separator_location = 0;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    result.erase(last_separator_location);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keyword">static</span> std::tuple&lt;key_type, key_type&gt; path_basename(<span class="keyword">const</span> key_type&amp; path) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keyword">auto</span> last_separator_location = path.rfind(separator);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keywordflow">if</span> (last_separator_location == key_type::npos) last_separator_location = 0;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    key_type basename = path;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    basename.erase(last_separator_location);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    key_type <a class="code" href="namespaceparse__nist__41.html#a84786d9cd3835f04f9d6044ba97efe4a">key</a> = (last_separator_location == 0)</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                       ? path</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                       : path.substr(last_separator_location + 1);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">return</span> std::make_tuple(basename, <a class="code" href="namespaceparse__nist__41.html#a84786d9cd3835f04f9d6044ba97efe4a">key</a>);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  }</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordtype">bool</span> exists_(<span class="keyword">const</span> key_type&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">return</span> top_tree_-&gt;get_child_optional(ptree::path_type{path, separator}) !=</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;           boost::optional&lt;ptree&amp;&gt;();</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  }</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160; <span class="keyword">protected</span>:</div><div class="line"><a name="l01197"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a13316eac2a5174bcbde8fa240b5155f3"> 1197</a></span>&#160;  <span class="keyword">virtual</span> boost::optional&lt;const ptree&amp;&gt; <a class="code" href="classmpqc_1_1_key_val.html#a13316eac2a5174bcbde8fa240b5155f3">get_subtree</a>(</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path)<span class="keyword"> const </span>{</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keyword">auto</span> abs_path = resolve_path(path);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><span class="keyword">const </span><a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a>&amp;<span class="keyword">&gt;</span>(*top_tree_)</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        .get_child_optional(ptree::path_type{abs_path, separator});</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  }</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01206"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1bad__input.html"> 1206</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">bad_input</a> : <span class="keyword">public</span> std::runtime_error {</div><div class="line"><a name="l01207"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1bad__input.html#a8f851f2e2c74a0371267b60564b9a6ae"> 1207</a></span>&#160;    <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html#a8f851f2e2c74a0371267b60564b9a6ae">bad_input</a>(<span class="keyword">const</span> std::string&amp; _what, <span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path)</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        : <a class="code" href="namespacestd.html">std</a>::runtime_error(_what + <span class="stringliteral">&quot; (path=&quot;</span> + path + <span class="stringliteral">&quot;)&quot;</span>) {}</div><div class="line"><a name="l01209"></a><span class="lineno"><a class="line" href="structmpqc_1_1_key_val_1_1bad__input.html#af2c850fea7e81c4ca19e2eb0e43e91be"> 1209</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html#af2c850fea7e81c4ca19e2eb0e43e91be">~bad_input</a>() noexcept {}</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  };</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;};  <span class="comment">// KeyVal</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;KeyVal <a class="code" href="namespacempqc.html#ac94cd3982209ff67c79e1eb918afe61b">operator+</a>(<span class="keyword">const</span> KeyVal&amp; first, <span class="keyword">const</span> KeyVal&amp; second);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="keyword">namespace </span>detail {</div><div class="line"><a name="l01224"></a><span class="lineno"><a class="line" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html"> 1224</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html">SubTreeKeyVal</a> : <span class="keyword">public</span> <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a> {</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l01226"></a><span class="lineno"><a class="line" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html#afee23b42e15447980fd1c9e813724b1b"> 1226</a></span>&#160;  <a class="code" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html#afee23b42e15447980fd1c9e813724b1b">SubTreeKeyVal</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">ptree</a>&amp; tree, <span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>&amp; kv)</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      : <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a>(kv), subtree_(tree) {}</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"><a class="line" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html#af3171c53937db9f23b1010f1cfe119ba"> 1229</a></span>&#160;  <a class="code" href="classmpqc_1_1_key_val.html">KeyVal</a> <a class="code" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html#af3171c53937db9f23b1010f1cfe119ba">keyval</a>(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path)<span class="keyword"> const override </span>{</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> subtree = this-&gt;get_subtree(path))</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html">SubTreeKeyVal</a>(*subtree, *<span class="keyword">this</span>);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          std::string(<span class="stringliteral">&quot;detail::KeyVal::keyval: path not found&quot;</span>), path);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  }</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keyword">const</span> ptree&amp; subtree_;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  boost::optional&lt;const ptree&amp;&gt; get_subtree(</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="keyword">const</span> key_type&amp; path)<span class="keyword"> const override </span>{</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordflow">if</span> (path.empty())  <span class="comment">// getting elements of arrays of scalars with give empty</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                       <span class="comment">// path</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="keywordflow">return</span> subtree_;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (path[0] != separator)  <span class="comment">// will parse down into the subtree when</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                    <span class="comment">// making arrays of objects</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <span class="keywordflow">return</span> subtree_.get_child_optional(ptree::path_type{path, separator});</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">else</span>  <span class="comment">// what should the default be if given absolute path? option 1: use</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          <span class="comment">// KeyVal::get_subtree,</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <span class="comment">// else throw, probably did not want SubTreeKeyVal in this case after all</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(<span class="stringliteral">&quot;detail::SubTreeKeyVal given an absolute path&quot;</span>,</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                              path);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="comment">// return this-&gt;KeyVal::get_subtree(path);</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;};</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;}  <span class="comment">// namespace detail</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> SequenceContainer, <span class="keyword">typename</span> Val<span class="keywordtype">id</span>ator&gt;</div><div class="line"><a name="l01260"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#ae5208351c770b0cf48e4be57ccc39ccb"> 1260</a></span>&#160;SequenceContainer KeyVal::value(</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path,</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    Validator&amp;&amp; validator_,</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    std::enable_if_t&lt;KeyVal::is_sequence&lt;SequenceContainer&gt;::value &amp;&amp;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        std::is_same&lt;<span class="keywordtype">bool</span>, decltype(std::declval&lt;Validator&gt;()(</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;            std::declval&lt;<span class="keyword">const</span> <span class="keyword">typename</span> SequenceContainer::</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;            <a class="code" href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">value_type</a>&amp;&gt;()))&gt;::value&gt;*)<span class="keyword"> const </span>{</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keyword">using</span> <a class="code" href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">value_type</a> = <span class="keyword">typename</span> SequenceContainer::value_type;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  SequenceContainer result;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  std::remove_reference_t&lt;Validator&gt; validator(std::forward&lt;Validator&gt;(validator_));</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> vec_ptree_opt = this-&gt;get_subtree(path)) {</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="keyword">auto</span> vec_ptree = *vec_ptree_opt;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      KeyVal::resize(result, vec_ptree.size());</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      <span class="keyword">auto</span> iter = result.begin();</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <span class="keywordtype">size_t</span> count = 0;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; elem_ptree : vec_ptree) {</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        assert(elem_ptree.first == <span class="stringliteral">&quot;&quot;</span>  <span class="comment">// JSON array spec</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;               ||</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;               elem_ptree.first ==</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                   <a class="code" href="group___init.html#ga40d388c6444549a58471f357f5d21995">std::to_string</a>(</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                       count)  <span class="comment">// 0-based array keys, a la ipv2, usable with XML</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        );</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <a class="code" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html">detail::SubTreeKeyVal</a> stree_kv(elem_ptree.second, *<span class="keyword">this</span>);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        *iter = stree_kv.<a class="code" href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">value</a>&lt;<a class="code" href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">value_type</a>&gt;(<span class="stringliteral">&quot;&quot;</span>, validator);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        ++iter;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        ++count;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      }</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    } <span class="keywordflow">catch</span> (boost::property_tree::ptree_bad_data&amp; x) {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;          std::string(<span class="stringliteral">&quot;value &quot;</span>) + x.data&lt;<a class="code" href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">KeyVal::value_type</a>&gt;() +</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;              <span class="stringliteral">&quot; could not be converted to the desired datatype&quot;</span>,</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;          resolve_path(path));</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    } <span class="keywordflow">catch</span> (boost::property_tree::ptree_bad_path&amp; x) {</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;          std::string(<span class="stringliteral">&quot;path &quot;</span>) + x.path&lt;<a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&gt;() + <span class="stringliteral">&quot; not found&quot;</span>,</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;          resolve_path(path));</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    }</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(std::string(<span class="stringliteral">&quot;path not found&quot;</span>),</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                            to_absolute_path(path));</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;}</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Val<span class="keywordtype">id</span>ator&gt;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;std::enable_if_t&lt;not KeyVal::is_sequence&lt;T&gt;::value &amp;&amp;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                     <a class="code" href="classmpqc_1_1utility_1_1meta_1_1can__construct.html">utility::meta::can_construct&lt;T, const KeyVal&amp;&gt;::value</a> &amp;&amp;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    std::is_same&lt;bool, decltype(std::declval&lt;Validator&gt;()(</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        std::declval&lt;const T&amp;&gt;()))&gt;::value,</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                 T&gt;</div><div class="line"><a name="l01310"></a><span class="lineno"><a class="line" href="classmpqc_1_1_key_val.html#a8ed111b8ef742a1b81a6723faf01884f"> 1310</a></span>&#160;KeyVal::value(<span class="keyword">const</span> <a class="code" href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">key_type</a>&amp; path, Validator&amp;&amp; validator)<span class="keyword"> const </span>{</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  <span class="keyword">const</span> <a class="code" href="classmpqc_1_1detail_1_1_sub_tree_key_val.html">detail::SubTreeKeyVal</a> stree_kv(*(this-&gt;get_subtree(path)), *<span class="keyword">this</span>);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="keyword">auto</span> result = T(stree_kv);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keywordflow">if</span> (validator(result) == <span class="keyword">false</span>) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    std::ostringstream oss;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    oss &lt;&lt; <span class="stringliteral">&quot;value &quot;</span> &lt;&lt; <a class="code" href="namespacempqc_1_1utility.html#a356824b706457655139b803003875e63">utility::to_ostream</a>(result) &lt;&lt; <span class="stringliteral">&quot; did not pass validation&quot;</span>;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="structmpqc_1_1_key_val_1_1bad__input.html">KeyVal::bad_input</a>(oss.str(), to_absolute_path(path));</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  }</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;}</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;static_assert(<a class="code" href="classmpqc_1_1utility_1_1meta_1_1can__construct.html">utility::meta::can_construct&lt;double, const KeyVal&amp;&gt;::value</a> ==</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                  <span class="keyword">false</span>,</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;              <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;static_assert(<a class="code" href="classmpqc_1_1utility_1_1meta_1_1can__construct.html">utility::meta::can_construct&lt;std::string, const KeyVal&amp;&gt;::value</a> ==</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                  <span class="keyword">false</span>,</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;              <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;}  <span class="comment">// namespace mpqc</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="preprocessor">#endif  // MPQC4_SRC_MPQC_UTIL_KEYVAL_KEYVAL_H_</span></div><div class="ttc" id="structmpqc_1_1_key_val_1_1bad__input_html_af2c850fea7e81c4ca19e2eb0e43e91be"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1bad__input.html#af2c850fea7e81c4ca19e2eb0e43e91be">mpqc::KeyVal::bad_input::~bad_input</a></div><div class="ttdeci">virtual ~bad_input() noexcept</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l01209">keyval.h:1209</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a8e61433f370361dff9a54be10ad99dc4a466deec76ecdf5fca6d38571f6324d54"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4a466deec76ecdf5fca6d38571f6324d54">mpqc::KeyVal::InputFormat::json</a></div></div>
<div class="ttc" id="namespacempqc_html_a44c41de87924d6fc1a88dc1943abab3c"><div class="ttname"><a href="namespacempqc.html#a44c41de87924d6fc1a88dc1943abab3c">mpqc::Describable</a></div><div class="ttdeci">std::is_base_of&lt; DescribedClass, T &gt; Describable</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00086">keyval.h:86</a></div></div>
<div class="ttc" id="group___init_html_ga40d388c6444549a58471f357f5d21995"><div class="ttname"><a href="group___init.html#ga40d388c6444549a58471f357f5d21995">mpqc::to_string</a></div><div class="ttdeci">std::string to_string(MPQCInit::InputFormat f)</div><div class="ttdef"><b>Definition:</b> <a href="mpqc__init_8h_source.html#l00144">mpqc_init.h:144</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_ab48476282a67900c226e11ba175f9b18"><div class="ttname"><a href="classmpqc_1_1_key_val.html#ab48476282a67900c226e11ba175f9b18">mpqc::KeyVal::value_type</a></div><div class="ttdeci">ptree::data_type value_type</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00361">keyval.h:361</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_ac0db7df2e202e9e3b522bb9357171584"><div class="ttname"><a href="classmpqc_1_1_described_class.html#ac0db7df2e202e9e3b522bb9357171584">mpqc::DescribedClass::keyval_ctor_registry</a></div><div class="ttdeci">static const keyval_ctor_registry_type &amp; keyval_ctor_registry()</div><div class="ttdoc">returns const ref to the keyval ctor registry </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00214">keyval.h:214</a></div></div>
<div class="ttc" id="namespaceboost_html"><div class="ttname"><a href="namespaceboost.html">boost</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00032">keyval.h:32</a></div></div>
<div class="ttc" id="classmpqc_1_1utility_1_1meta_1_1can__construct_html_aa157a44bece13521bd5c226bb28ba126"><div class="ttname"><a href="classmpqc_1_1utility_1_1meta_1_1can__construct.html#aa157a44bece13521bd5c226bb28ba126">mpqc::utility::meta::can_construct::value</a></div><div class="ttdeci">static constexpr const bool value</div><div class="ttdef"><b>Definition:</b> <a href="predicates_8h_source.html#l00047">predicates.h:47</a></div></div>
<div class="ttc" id="namespacempqc_1_1detail_html_a93f6db2b6ef4cae156a4fbae956136b0"><div class="ttname"><a href="namespacempqc_1_1detail.html#a93f6db2b6ef4cae156a4fbae956136b0">mpqc::detail::guid</a></div><div class="ttdeci">const char * guid()</div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1is__positive__t_html"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1is__positive__t.html">mpqc::KeyVal::is_positive_t</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00659">keyval.h:659</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a00f44def7e5382ec9c1994efdbb71173"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a00f44def7e5382ec9c1994efdbb71173">mpqc::KeyVal::path</a></div><div class="ttdeci">std::string path() const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00980">keyval.h:980</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a1967495bff6a013f3de037cec1b626d0"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a1967495bff6a013f3de037cec1b626d0">mpqc::KeyVal::erase</a></div><div class="ttdeci">KeyVal &amp; erase(const key_type &amp;path)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00635">keyval.h:635</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_ae287fb3c07e957abba5b38fb9550128a"><div class="ttname"><a href="classmpqc_1_1_key_val.html#ae287fb3c07e957abba5b38fb9550128a">mpqc::KeyVal::separator</a></div><div class="ttdeci">static constexpr char separator</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00362">keyval.h:362</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a47b3acf9305b2b0c758b9e3821b13301"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a47b3acf9305b2b0c758b9e3821b13301">mpqc::KeyVal::default_class_key</a></div><div class="ttdeci">std::string default_class_key() const</div><div class="ttdoc">obtains default class key for class T </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00525">keyval.h:525</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a7b191e01f96e5809ac4fb2d8dce0bd56"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a7b191e01f96e5809ac4fb2d8dce0bd56">mpqc::KeyVal::is_positive</a></div><div class="ttdeci">static const is_positive_t is_positive</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00665">keyval.h:665</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1is__nonnegative__t_html_a755f03246bfb4bd6b85d98054dc33d0e"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1is__nonnegative__t.html#a755f03246bfb4bd6b85d98054dc33d0e">mpqc::KeyVal::is_nonnegative_t::operator()</a></div><div class="ttdeci">constexpr bool operator()(Arg &amp;&amp;arg) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00654">keyval.h:654</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a9d19d7373b0ffa6ad3d029d5352f16a9"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a9d19d7373b0ffa6ad3d029d5352f16a9">mpqc::KeyVal::clone</a></div><div class="ttdeci">KeyVal clone() const</div><div class="ttdoc">creates a deep copy of this object </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8cpp_source.html#l00096">keyval.cpp:96</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a9bf3726bba5b069e5f7aaaf2fef6ee28"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a9bf3726bba5b069e5f7aaaf2fef6ee28">mpqc::KeyVal::exists</a></div><div class="ttdeci">bool exists(const key_type &amp;path) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00536">keyval.h:536</a></div></div>
<div class="ttc" id="structmpqc_1_1_described_class_1_1registrar_html"><div class="ttname"><a href="structmpqc_1_1_described_class_1_1registrar.html">mpqc::DescribedClass::registrar</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00191">keyval.h:191</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a8da9a1a8d026e992d5941d1929cc7726"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a8da9a1a8d026e992d5941d1929cc7726">mpqc::KeyVal::write_json</a></div><div class="ttdeci">void write_json(std::basic_ostream&lt; key_type::value_type &gt; &amp;os) const</div><div class="ttdoc">write to stream in JSON form </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00961">keyval.h:961</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_af1e398eb00a68455ba539ecac59d0716"><div class="ttname"><a href="classmpqc_1_1_key_val.html#af1e398eb00a68455ba539ecac59d0716">mpqc::KeyVal::class_ptr</a></div><div class="ttdeci">std::shared_ptr&lt; T &gt; class_ptr(const key_type &amp;path=key_type(), bool bypass_registry=false, bool disable_bad_input=false) const</div><div class="ttdoc">return a pointer to an object at the given path </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00865">keyval.h:865</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a88bd8bd53608a85bfcb9827ca9959278"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a88bd8bd53608a85bfcb9827ca9959278">mpqc::KeyVal::write_info</a></div><div class="ttdeci">void write_info(std::basic_ostream&lt; typename key_type::value_type &gt; &amp;os) const</div><div class="ttdoc">write to stream in INFO form </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00970">keyval.h:970</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_aaf8570443e0985afd7e99bd39769b881"><div class="ttname"><a href="classmpqc_1_1_described_class.html#aaf8570443e0985afd7e99bd39769b881">mpqc::DescribedClass::DescribedClass</a></div><div class="ttdeci">DescribedClass()=default</div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html"><div class="ttname"><a href="classmpqc_1_1_described_class.html">mpqc::DescribedClass</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00117">keyval.h:117</a></div></div>
<div class="ttc" id="stream_8h_html"><div class="ttname"><a href="stream_8h.html">stream.h</a></div></div>
<div class="ttc" id="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4_html_a3d81a603febf5055bad2eae96dc25e6a"><div class="ttname"><a href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#a3d81a603febf5055bad2eae96dc25e6a">boost::property_tree::customize_stream&lt; Ch, Traits, E *, void &gt;::extract</a></div><div class="ttdeci">static void extract(std::basic_istream&lt; Ch, Traits &gt; &amp;s, E *&amp;e)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00046">keyval.h:46</a></div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1is__nonnegative__t_html"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1is__nonnegative__t.html">mpqc::KeyVal::is_nonnegative_t</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00652">keyval.h:652</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a7f54bf6f1028581ad68496a97afd9174"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a7f54bf6f1028581ad68496a97afd9174">mpqc::KeyVal::value</a></div><div class="ttdeci">T value(const key_type &amp;path, Validator &amp;&amp;validator=Validator{}) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00687">keyval.h:687</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a8e61433f370361dff9a54be10ad99dc4acaf9b6b99962bf5c2264824231d7a40c"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4acaf9b6b99962bf5c2264824231d7a40c">mpqc::KeyVal::InputFormat::info</a></div></div>
<div class="ttc" id="namespacempqc_html_ac94cd3982209ff67c79e1eb918afe61b"><div class="ttname"><a href="namespacempqc.html#ac94cd3982209ff67c79e1eb918afe61b">mpqc::operator+</a></div><div class="ttdeci">KeyVal operator+(const KeyVal &amp;first, const KeyVal &amp;second)</div></div>
<div class="ttc" id="namespaceparse__nist__41_html_a84786d9cd3835f04f9d6044ba97efe4a"><div class="ttname"><a href="namespaceparse__nist__41.html#a84786d9cd3835f04f9d6044ba97efe4a">parse_nist_41.key</a></div><div class="ttdeci">key</div><div class="ttdef"><b>Definition:</b> <a href="parse__nist__41_8py_source.html#l00031">parse_nist_41.py:31</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a2dd4fb13cb0b2c30dfd9b992764e23a4"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a2dd4fb13cb0b2c30dfd9b992764e23a4">mpqc::KeyVal::assign</a></div><div class="ttdeci">KeyVal &amp; assign(const key_type &amp;path, const std::shared_ptr&lt; T &gt; &amp;value)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00625">keyval.h:625</a></div></div>
<div class="ttc" id="classmpqc_1_1detail_1_1_sub_tree_key_val_html_af3171c53937db9f23b1010f1cfe119ba"><div class="ttname"><a href="classmpqc_1_1detail_1_1_sub_tree_key_val.html#af3171c53937db9f23b1010f1cfe119ba">mpqc::detail::SubTreeKeyVal::keyval</a></div><div class="ttdeci">KeyVal keyval(const key_type &amp;path) const override</div><div class="ttdoc">construct a KeyVal representing a subtree located at the given path </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l01229">keyval.h:1229</a></div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1bad__input_html_a8f851f2e2c74a0371267b60564b9a6ae"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1bad__input.html#a8f851f2e2c74a0371267b60564b9a6ae">mpqc::KeyVal::bad_input::bad_input</a></div><div class="ttdeci">bad_input(const std::string &amp;_what, const key_type &amp;path)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l01207">keyval.h:1207</a></div></div>
<div class="ttc" id="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4_html_a61e261a81b048794ca23dfd9db2cf971"><div class="ttname"><a href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#a61e261a81b048794ca23dfd9db2cf971">boost::property_tree::customize_stream&lt; Ch, Traits, E *, void &gt;::insert</a></div><div class="ttdeci">static void insert(std::basic_ostream&lt; Ch, Traits &gt; &amp;s, const E *e)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00039">keyval.h:39</a></div></div>
<div class="ttc" id="classmpqc_1_1utility_1_1meta_1_1can__construct_html"><div class="ttname"><a href="classmpqc_1_1utility_1_1meta_1_1can__construct.html">mpqc::utility::meta::can_construct</a></div><div class="ttdef"><b>Definition:</b> <a href="predicates_8h_source.html#l00038">predicates.h:38</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a60d929c7b336d452e1d1f38fe88729f2"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a60d929c7b336d452e1d1f38fe88729f2">mpqc::KeyVal::is_nonnegative</a></div><div class="ttdeci">static const is_nonnegative_t is_nonnegative</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00658">keyval.h:658</a></div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1dummy__validator__t_html_a02ff6324704e16ff704e48ff3777788b"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1dummy__validator__t.html#a02ff6324704e16ff704e48ff3777788b">mpqc::KeyVal::dummy_validator_t::operator()</a></div><div class="ttdeci">constexpr bool operator()(Args &amp;&amp;... args) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00647">keyval.h:647</a></div></div>
<div class="ttc" id="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4_html_adb1869bcf09ffce48ef90a2e472d40eb"><div class="ttname"><a href="structboost_1_1property__tree_1_1customize__stream_3_01_ch_00_01_traits_00_01_e_01_5_00_01void_01_4.html#adb1869bcf09ffce48ef90a2e472d40eb">boost::property_tree::customize_stream&lt; Ch, Traits, E *, void &gt;::stored_t</a></div><div class="ttdeci">size_t stored_t</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00036">keyval.h:36</a></div></div>
<div class="ttc" id="namespacempqc_html"><div class="ttname"><a href="namespacempqc.html">mpqc</a></div><div class="ttdoc">This file contains functions to compute effective Hamiltonian of CCSD. </div><div class="ttdef"><b>Definition:</b> <a href="libmpqc_8cpp_source.html#l00001">libmpqc.cpp:1</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a9cd0c026374857bf056ec0bb5316d03d"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a9cd0c026374857bf056ec0bb5316d03d">mpqc::KeyVal::key_type</a></div><div class="ttdeci">ptree::key_type key_type</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00360">keyval.h:360</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a89c571756cc385fe4199dc7260421a6b"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a89c571756cc385fe4199dc7260421a6b">mpqc::KeyVal::operator=</a></div><div class="ttdeci">KeyVal &amp; operator=(const KeyVal &amp;other)=default</div><div class="ttdoc">copy assignment </div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_aa4b56eaba6efe5741ec1f7773504c590"><div class="ttname"><a href="classmpqc_1_1_described_class.html#aa4b56eaba6efe5741ec1f7773504c590">mpqc::DescribedClass::type_to_keyval_ctor</a></div><div class="ttdeci">static keyval_ctor_wrapper_type type_to_keyval_ctor(const std::string &amp;type_name)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8cpp_source.html#l00059">keyval.cpp:59</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_ad60555be0b13569893877d119d4b92b2"><div class="ttname"><a href="classmpqc_1_1_described_class.html#ad60555be0b13569893877d119d4b92b2">mpqc::DescribedClass::keyval_ctor_wrapper_type</a></div><div class="ttdeci">std::shared_ptr&lt; DescribedClass &gt;(* keyval_ctor_wrapper_type)(const KeyVal &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00123">keyval.h:123</a></div></div>
<div class="ttc" id="namespacempqc_1_1utility_html_a356824b706457655139b803003875e63"><div class="ttname"><a href="namespacempqc_1_1utility.html#a356824b706457655139b803003875e63">mpqc::utility::to_ostream</a></div><div class="ttdeci">std::enable_if_t&lt; madness::is_ostreammable&lt; T &gt;::value, T &gt; to_ostream(T &amp;&amp;value)</div><div class="ttdoc">forwards value to std::ostream if possible </div><div class="ttdef"><b>Definition:</b> <a href="stream_8h_source.html#l00016">stream.h:16</a></div></div>
<div class="ttc" id="classmpqc_1_1detail_1_1_sub_tree_key_val_html"><div class="ttname"><a href="classmpqc_1_1detail_1_1_sub_tree_key_val.html">mpqc::detail::SubTreeKeyVal</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l01224">keyval.h:1224</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a749c4a122cfcc7e0cf862911a166c19e"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a749c4a122cfcc7e0cf862911a166c19e">mpqc::KeyVal::KeyVal</a></div><div class="ttdeci">KeyVal()</div><div class="ttdoc">creates empty KeyVal </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8cpp_source.html#l00090">keyval.cpp:90</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a8e61433f370361dff9a54be10ad99dc4a0f635d0e0f3874fff8b581c132e6c7a7"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4a0f635d0e0f3874fff8b581c132e6c7a7">mpqc::KeyVal::InputFormat::xml</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a6eff3369d0958de41d78da924c3d6263"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a6eff3369d0958de41d78da924c3d6263">mpqc::KeyVal::assign</a></div><div class="ttdeci">KeyVal &amp; assign(const key_type &amp;path, const T &amp;value)</div><div class="ttdoc">assign simple value at the given path (overwrite, if necessary) </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00582">keyval.h:582</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a8e61433f370361dff9a54be10ad99dc4"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4">mpqc::KeyVal::InputFormat</a></div><div class="ttdeci">InputFormat</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00356">keyval.h:356</a></div></div>
<div class="ttc" id="group___chemistry_e_s_spin_html_ga28cc62c8097e7422638945411208bbd2"><div class="ttname"><a href="group___chemistry_e_s_spin.html#ga28cc62c8097e7422638945411208bbd2">mpqc::other</a></div><div class="ttdeci">constexpr SpinCase1 other(SpinCase1 S)</div><div class="ttdoc">given 1-spin return the other 1-spin </div><div class="ttdef"><b>Definition:</b> <a href="spin_8cpp_source.html#l00061">spin.cpp:61</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a71722c4844b4b602dbe14bd14a5fffba"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a71722c4844b4b602dbe14bd14a5fffba">mpqc::KeyVal::assign</a></div><div class="ttdeci">KeyVal &amp; assign(const key_type &amp;path, const SequenceContainer &amp;value, bool json_style=true, std::enable_if_t&lt; KeyVal::is_sequence&lt; SequenceContainer &gt;::value &gt; *=nullptr)</div><div class="ttdoc">Assign a sequence container at the given path (overwrite, if necessary). </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00605">keyval.h:605</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a2602c29e5878d0e060eba4d9fd8f0491"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a2602c29e5878d0e060eba4d9fd8f0491">mpqc::KeyVal::exists_class</a></div><div class="ttdeci">bool exists_class(const key_type &amp;path) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00551">keyval.h:551</a></div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1is__positive__t_html_adbcf3bb38bc8b9d8284962b065e2de82"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1is__positive__t.html#adbcf3bb38bc8b9d8284962b065e2de82">mpqc::KeyVal::is_positive_t::operator()</a></div><div class="ttdeci">constexpr bool operator()(Arg &amp;&amp;arg) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00661">keyval.h:661</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_aa1bf13d01bb824d947469ab0dabf8324"><div class="ttname"><a href="classmpqc_1_1_described_class.html#aa1bf13d01bb824d947469ab0dabf8324">mpqc::DescribedClass::class_key</a></div><div class="ttdeci">static std::string class_key()</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00162">keyval.h:162</a></div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1dummy__validator__t_html"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1dummy__validator__t.html">mpqc::KeyVal::dummy_validator_t</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00645">keyval.h:645</a></div></div>
<div class="ttc" id="structmpqc_1_1detail_1_1register__keyval__ctor_html"><div class="ttname"><a href="structmpqc_1_1detail_1_1register__keyval__ctor.html">mpqc::detail::register_keyval_ctor</a></div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00066">keyval.h:66</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a6a75b3737bba3d139cba7f2d0810f80b"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a6a75b3737bba3d139cba7f2d0810f80b">mpqc::KeyVal::write_xml</a></div><div class="ttdeci">void write_xml(std::basic_ostream&lt; typename key_type::value_type &gt; &amp;os) const</div><div class="ttdoc">write to stream in XML form </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00952">keyval.h:952</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a78a81ca8f160b9d54411505140ab8b06"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a78a81ca8f160b9d54411505140ab8b06">mpqc::KeyVal::read_xml</a></div><div class="ttdeci">void read_xml(std::basic_istream&lt; typename key_type::value_type &gt; &amp;is)</div><div class="ttdoc">write from stream in XML form </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00956">keyval.h:956</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a645729e75db76c2b8d1d871345d0d01f"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a645729e75db76c2b8d1d871345d0d01f">mpqc::KeyVal::value</a></div><div class="ttdeci">T value(const key_type &amp;path, const T &amp;default_value, Validator &amp;&amp;validator=Validator{}) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00821">keyval.h:821</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a013e32435b4fbc49c5c20ea74dd6fa26"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a013e32435b4fbc49c5c20ea74dd6fa26">mpqc::KeyVal::keyval</a></div><div class="ttdeci">virtual KeyVal keyval(const key_type &amp;path) const</div><div class="ttdoc">construct a KeyVal representing a subtree located at the given path </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00499">keyval.h:499</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_afd9c1e39d18333127017d59879fe382f"><div class="ttname"><a href="classmpqc_1_1_key_val.html#afd9c1e39d18333127017d59879fe382f">mpqc::KeyVal::top_tree</a></div><div class="ttdeci">std::shared_ptr&lt; ptree &gt; top_tree() const</div><div class="ttdoc">returns a shared_ptr to the (top) tree </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00505">keyval.h:505</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a0a1184277466a6d293987d573d027d82"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a0a1184277466a6d293987d573d027d82">mpqc::KeyVal::read_info</a></div><div class="ttdeci">void read_info(std::basic_istream&lt; typename key_type::value_type &gt; &amp;is)</div><div class="ttdoc">write from stream in INFO form </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00974">keyval.h:974</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_a6dda7d6cf1cf1e6932d2851594f967b3"><div class="ttname"><a href="classmpqc_1_1_described_class.html#a6dda7d6cf1cf1e6932d2851594f967b3">mpqc::DescribedClass::class_key</a></div><div class="ttdeci">std::string class_key() const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00175">keyval.h:175</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_a91c2eb064e67b1aeb3d6239566a14f15"><div class="ttname"><a href="classmpqc_1_1_described_class.html#a91c2eb064e67b1aeb3d6239566a14f15">mpqc::DescribedClass::register_keyval_ctor</a></div><div class="ttdeci">static void register_keyval_ctor()</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00130">keyval.h:130</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a13316eac2a5174bcbde8fa240b5155f3"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a13316eac2a5174bcbde8fa240b5155f3">mpqc::KeyVal::get_subtree</a></div><div class="ttdeci">virtual boost::optional&lt; const ptree &amp; &gt; get_subtree(const key_type &amp;path) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l01197">keyval.h:1197</a></div></div>
<div class="ttc" id="predicates_8h_html"><div class="ttname"><a href="predicates_8h.html">predicates.h</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a5ab3182385ef098f63732757c676fe7c"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a5ab3182385ef098f63732757c676fe7c">mpqc::KeyVal::value</a></div><div class="ttdeci">T value(const key_type &amp;path, const T &amp;default_value, const key_type &amp;deprecated_path, Validator &amp;&amp;validator=Validator{}) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00771">keyval.h:771</a></div></div>
<div class="ttc" id="structmpqc_1_1_described_class_1_1registrar_html_ab79b7b0ce818020186b39d79afb60cb7"><div class="ttname"><a href="structmpqc_1_1_described_class_1_1registrar.html#ab79b7b0ce818020186b39d79afb60cb7">mpqc::DescribedClass::registrar::registrar</a></div><div class="ttdeci">registrar()</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00192">keyval.h:192</a></div></div>
<div class="ttc" id="classmpqc_1_1detail_1_1_sub_tree_key_val_html_afee23b42e15447980fd1c9e813724b1b"><div class="ttname"><a href="classmpqc_1_1detail_1_1_sub_tree_key_val.html#afee23b42e15447980fd1c9e813724b1b">mpqc::detail::SubTreeKeyVal::SubTreeKeyVal</a></div><div class="ttdeci">SubTreeKeyVal(const ptree &amp;tree, const KeyVal &amp;kv)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l01226">keyval.h:1226</a></div></div>
<div class="ttc" id="structmpqc_1_1_key_val_1_1bad__input_html"><div class="ttname"><a href="structmpqc_1_1_key_val_1_1bad__input.html">mpqc::KeyVal::bad_input</a></div><div class="ttdoc">KeyVal exception. </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l01206">keyval.h:1206</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html"><div class="ttname"><a href="classmpqc_1_1_key_val.html">mpqc::KeyVal</a></div><div class="ttdoc">KeyVal specifies C++ primitive data (booleans, integers, reals, string) and user-defined objects obta...</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00350">keyval.h:350</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_a57120bc8692f1c8cb3159b4f13f2c91e"><div class="ttname"><a href="classmpqc_1_1_described_class.html#a57120bc8692f1c8cb3159b4f13f2c91e">mpqc::DescribedClass::is_registered</a></div><div class="ttdeci">static bool is_registered()</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00147">keyval.h:147</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a75fa7e0ea9e39797bf99b9815f70d19f"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a75fa7e0ea9e39797bf99b9815f70d19f">mpqc::KeyVal::set_default_class_key</a></div><div class="ttdeci">KeyVal &amp; set_default_class_key(const std::string &amp;key)</div><div class="ttdoc">obtains default class key for class T </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00515">keyval.h:515</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a32a637d5baad1c583252aad02015326b"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a32a637d5baad1c583252aad02015326b">mpqc::KeyVal::count</a></div><div class="ttdeci">boost::optional&lt; size_t &gt; count(const key_type &amp;path) const</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00571">keyval.h:571</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a5246dff976d813166548b2e3782b2dd7"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a5246dff976d813166548b2e3782b2dd7">mpqc::KeyVal::throw_if_deprecated_path</a></div><div class="ttdeci">static bool throw_if_deprecated_path()</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00366">keyval.h:366</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_ab32d9e717a274d228dec0a509ace84c2"><div class="ttname"><a href="classmpqc_1_1_key_val.html#ab32d9e717a274d228dec0a509ace84c2">mpqc::KeyVal::tree</a></div><div class="ttdeci">std::shared_ptr&lt; ptree &gt; tree() const</div><div class="ttdoc">returns a shared_ptr to this (sub)tree </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8cpp_source.html#l00101">keyval.cpp:101</a></div></div>
<div class="ttc" id="classmpqc_1_1_described_class_html_a870afa0e09720b6cea05f44de59fd668"><div class="ttname"><a href="classmpqc_1_1_described_class.html#a870afa0e09720b6cea05f44de59fd668">mpqc::DescribedClass::~DescribedClass</a></div><div class="ttdeci">virtual ~DescribedClass()</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00120">keyval.h:120</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_adb280f12507d346648c0ed5b748a4aa2"><div class="ttname"><a href="classmpqc_1_1_key_val.html#adb280f12507d346648c0ed5b748a4aa2">mpqc::KeyVal::set_throw_if_deprecated_path</a></div><div class="ttdeci">static void set_throw_if_deprecated_path(bool f)</div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00371">keyval.h:371</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a8e61433f370361dff9a54be10ad99dc4afedb2d84cafe20862cb4399751a8a7e3"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a8e61433f370361dff9a54be10ad99dc4afedb2d84cafe20862cb4399751a8a7e3">mpqc::KeyVal::InputFormat::invalid</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_a3d0de8f5c809cbe7719ca54737a9ec35"><div class="ttname"><a href="classmpqc_1_1_key_val.html#a3d0de8f5c809cbe7719ca54737a9ec35">mpqc::KeyVal::read_json</a></div><div class="ttdeci">void read_json(std::basic_istream&lt; key_type::value_type &gt; &amp;is)</div><div class="ttdoc">read from stream in JSON form </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00965">keyval.h:965</a></div></div>
<div class="ttc" id="classmpqc_1_1_key_val_html_aea115806161eae9be862826dd18ffc35"><div class="ttname"><a href="classmpqc_1_1_key_val.html#aea115806161eae9be862826dd18ffc35">mpqc::KeyVal::ptree</a></div><div class="ttdeci">boost::property_tree::iptree ptree</div><div class="ttdoc">data type for representing a property tree </div><div class="ttdef"><b>Definition:</b> <a href="keyval_8h_source.html#l00359">keyval.h:359</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<address>
<small>
Generated at Mon Aug 27 2018 08:29:36 for <a
href="http://www.mpqc.org">MPQC</a>
4.0.0-beta.1 using the documentation package <a
href="http://www.doxygen.org">Doxygen</a>
1.8.14.
</small>
</address>
</body>
</html>
